{"version":3,"file":"session-database.js","names":["SessionDatabase","_dexie$Dexie","_inheritsLoose","databaseName","_this","call","version","stores","events","_proto","prototype","postRecord","record","add","getFullSnapshotsWithMeta","types","Array","of","EventType","FullSnapshot","valueOf","Meta","orderBy","reverse","filter","it","indexOf","type","toArray","Dexie"],"sources":["../../ts/js/lib/session-database.ts"],"sourcesContent":["import {Dexie} from \"dexie\";\nimport {EventType, RecordEvent} from \"VMPL_BugReplay/js/api/session\";\n\nexport default class SessionDatabase extends Dexie {\n    events!: Dexie.Table<RecordEvent, number>;\n\n    constructor(databaseName: string) {\n        super(databaseName);\n        this.version(1).stores({\n            events: 'timestamp,type,data',\n        });\n        this.version(2).stores({\n            events: '&timestamp,*type,data',\n        })\n    }\n\n    postRecord(record: RecordEvent): Promise<RecordEvent> {\n        return this.events.add(record);\n    }\n\n    getFullSnapshotsWithMeta(): Promise<RecordEvent[]> {\n        const types: number[] = Array.of(EventType.FullSnapshot.valueOf(), EventType.Meta.valueOf());\n        return this.events\n            .orderBy('timestamp').reverse()\n            .filter((it: RecordEvent) => types.indexOf(it.type.valueOf()) !== -1)\n            .toArray();\n    }\n}\n"],"mappings":";;;;;MAGqBA,eAAe,0BAAAC,YAAA;IAAA;;IAAAC,cAAA,CAAAF,eAAA,EAAAC,YAAA;IAGhC,SAAAD,gBAAYG,YAAoB,EAAE;MAAA,IAAAC,KAAA;MAC9BA,KAAA,GAAAH,YAAA,CAAAI,IAAA,OAAMF,YAAY,CAAC;MACnBC,KAAA,CAAKE,OAAO,CAAC,CAAC,CAAC,CAACC,MAAM,CAAC;QACnBC,MAAM,EAAE;MACZ,CAAC,CAAC;MACFJ,KAAA,CAAKE,OAAO,CAAC,CAAC,CAAC,CAACC,MAAM,CAAC;QACnBC,MAAM,EAAE;MACZ,CAAC,CAAC;MAAA,OAAAJ,KAAA;IACN;IAAC,IAAAK,MAAA,GAAAT,eAAA,CAAAU,SAAA;IAAAD,MAAA,CAEDE,UAAU,GAAV,SAAAA,WAAWC,MAAmB,EAAwB;MAClD,OAAO,IAAI,CAACJ,MAAM,CAACK,GAAG,CAACD,MAAM,CAAC;IAClC,CAAC;IAAAH,MAAA,CAEDK,wBAAwB,GAAxB,SAAAA,yBAAA,EAAmD;MAC/C,IAAMC,KAAe,GAAGC,KAAK,CAACC,EAAE,CAACC,kBAAS,CAACC,YAAY,CAACC,OAAO,CAAC,CAAC,EAAEF,kBAAS,CAACG,IAAI,CAACD,OAAO,CAAC,CAAC,CAAC;MAC5F,OAAO,IAAI,CAACZ,MAAM,CACbc,OAAO,CAAC,WAAW,CAAC,CAACC,OAAO,CAAC,CAAC,CAC9BC,MAAM,CAAC,UAACC,EAAe;QAAA,OAAKV,KAAK,CAACW,OAAO,CAACD,EAAE,CAACE,IAAI,CAACP,OAAO,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;MAAA,EAAC,CACpEQ,OAAO,CAAC,CAAC;IAClB,CAAC;IAAA,OAAA5B,eAAA;EAAA,EAvBwC6B,YAAK;EAAA,OAAA7B,eAAA;AAAA"}