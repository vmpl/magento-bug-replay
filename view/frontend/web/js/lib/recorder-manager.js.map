{"version":3,"file":"recorder-manager.js","names":["RecorderManager","sessionWorker","paginator","_itemsPaginator","registerSerializer","_workerSerializer","_proto","prototype","startRecord","self","stopRecord","rrweb","record","emit","event","post","init","instance","fetch","then","response","json","content","spawn","Worker","assetUrl","sessionLoader","initInstance","loadPaginatorItems","offset","limit","filter","sessions","items","map","it","timestamp","Date","href","URL","title"],"sources":["../../ts/js/lib/recorder-manager.ts"],"sourcesContent":["// @ts-ignore\nimport {JsonSerializable, registerSerializer, SerializerImplementation, spawn} from \"threads\";\nimport {RecordEvent, RecordSession, SessionWorker} from \"VMPL_BugReplay/js/api/session\";\nimport {ConfigWorkerContent} from \"VMPL_BugReplay/js/api/response\";\nimport ItemPaginator from \"VMPL_BugReplay/js/lib/items-paginator\";\nimport {IPaginatorFilter, IPaginatorLoader, IPaginatorResponse} from \"VMPL_BugReplay/js/api/paginator\";\nimport WorkerSerializer from \"VMPL_BugReplay/js/lib/worker-serializer\";\n\nexport default class RecorderManager implements IPaginatorLoader, SerializerImplementation {\n    stopRecord: Function;\n    readonly paginator: ItemPaginator<RecordSession[], RecorderManager>;\n\n    protected constructor(\n        protected readonly sessionWorker: SessionWorker,\n    ) {\n        this.paginator = new ItemPaginator([], this);\n        registerSerializer(WorkerSerializer);\n    }\n\n    startRecord() {\n        ((self) => {\n            self.stopRecord = rrweb.record({\n                emit(event: RecordEvent) {\n                    self.sessionWorker.post(event);\n                }\n            })\n        })(this);\n    }\n\n    static init(instance: string = 'BugReplay'): Promise<RecorderManager> {\n        return fetch('/vmpl-bug-report/config/worker')\n            .then(response => response.json())\n            .then((content: ConfigWorkerContent) => spawn(new Worker(content.assetUrl.sessionLoader)))\n            .then((sessionWorker: SessionWorker) => {\n                return sessionWorker.initInstance(instance)\n                    .then(() => new RecorderManager(sessionWorker))\n            })\n    }\n\n    loadPaginatorItems(offset: number, limit: number, filter: IPaginatorFilter): Promise<IPaginatorResponse> {\n        return this.sessionWorker.sessions(offset, limit, filter)\n            .then(items => {\n                items.items = items.items.map((it: any) => {\n                    return {\n                        timestamp: new Date(it.timestamp),\n                        href: new URL(it.href),\n                        title: it.title,\n                    }\n                })\n                return items;\n            });\n    }\n}\n"],"mappings":";;;EAAA;EAAA,IAQqBA,eAAe;IAAA;;IAIhC,SAAAA,gBACuBC,aAA4B,EACjD;MAAA,KADqBA,aAA4B,GAA5BA,aAA4B;MAE/C,IAAI,CAACC,SAAS,GAAG,IAAAC,eAAA,CAAkB,EAAE,EAAE,IAAI,CAAC;MAC5C,IAAAC,2BAAkB,EAAAC,iBAAiB,CAAC;IACxC;IAAC,IAAAC,MAAA,GAAAN,eAAA,CAAAO,SAAA;IAAAD,MAAA,CAEDE,WAAW,GAAX,SAAAA,YAAA,EAAc;MACV,CAAC,UAACC,IAAI,EAAK;QACPA,IAAI,CAACC,UAAU,GAAGC,KAAK,CAACC,MAAM,CAAC;UAC3BC,IAAI,WAAAA,KAACC,KAAkB,EAAE;YACrBL,IAAI,CAACR,aAAa,CAACc,IAAI,CAACD,KAAK,CAAC;UAClC;QACJ,CAAC,CAAC;MACN,CAAC,EAAE,IAAI,CAAC;IACZ,CAAC;IAAAd,eAAA,CAEMgB,IAAI,GAAX,SAAAA,KAAYC,QAAgB,EAA0C;MAAA,IAA1DA,QAAgB;QAAhBA,QAAgB,GAAG,WAAW;MAAA;MACtC,OAAOC,KAAK,CAAC,gCAAgC,CAAC,CACzCC,IAAI,CAAC,UAAAC,QAAQ;QAAA,OAAIA,QAAQ,CAACC,IAAI,CAAC,CAAC;MAAA,EAAC,CACjCF,IAAI,CAAC,UAACG,OAA4B;QAAA,OAAK,IAAAC,cAAK,EAAC,IAAIC,MAAM,CAACF,OAAO,CAACG,QAAQ,CAACC,aAAa,CAAC,CAAC;MAAA,EAAC,CACzFP,IAAI,CAAC,UAAClB,aAA4B,EAAK;QACpC,OAAOA,aAAa,CAAC0B,YAAY,CAACV,QAAQ,CAAC,CACtCE,IAAI,CAAC;UAAA,OAAM,IAAInB,eAAe,CAACC,aAAa,CAAC;QAAA,EAAC;MACvD,CAAC,CAAC;IACV,CAAC;IAAAK,MAAA,CAEDsB,kBAAkB,GAAlB,SAAAA,mBAAmBC,MAAc,EAAEC,KAAa,EAAEC,MAAwB,EAA+B;MACrG,OAAO,IAAI,CAAC9B,aAAa,CAAC+B,QAAQ,CAACH,MAAM,EAAEC,KAAK,EAAEC,MAAM,CAAC,CACpDZ,IAAI,CAAC,UAAAc,KAAK,EAAI;QACXA,KAAK,CAACA,KAAK,GAAGA,KAAK,CAACA,KAAK,CAACC,GAAG,CAAC,UAACC,EAAO,EAAK;UACvC,OAAO;YACHC,SAAS,EAAE,IAAIC,IAAI,CAACF,EAAE,CAACC,SAAS,CAAC;YACjCE,IAAI,EAAE,IAAIC,GAAG,CAACJ,EAAE,CAACG,IAAI,CAAC;YACtBE,KAAK,EAAEL,EAAE,CAACK;UACd,CAAC;QACL,CAAC,CAAC;QACF,OAAOP,KAAK;MAChB,CAAC,CAAC;IACV,CAAC;IAAA,OAAAjC,eAAA;EAAA;EAAA,OAAAA,eAAA;AAAA"}