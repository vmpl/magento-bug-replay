{"version":3,"file":"recorder-manager.js","names":["RecorderManager","sessionWorker","paginator","_itemsPaginator","_proto","prototype","startRecord","self","stopRecord","rrweb","record","emit","event","post","init","instance","fetch","then","response","json","content","WorkerClient","assetUrl","sessionLoader","initInstance","getEventsForSessionAt","sessions","events","items","uploadSessions","export","data","text","JSON","parse","object","console","log","loadPaginatorItems","offset","limit","filter"],"sources":["../../ts/js/lib/recorder-manager.ts"],"sourcesContent":["import {IRecordEvent, IRecordSession, SessionWorker} from \"VMPL_BugReplay/js/api/session\";\nimport {ConfigWorkerContent} from \"VMPL_BugReplay/js/api/response\";\nimport ItemPaginator from \"VMPL_BugReplay/js/lib/items-paginator\";\nimport {IPaginatorFilter, IPaginatorLoader, IPaginatorResponse} from \"VMPL_BugReplay/js/api/paginator\";\nimport {WorkerClient} from \"VMPL_BugReplay/js/lib/worker/client\";\ndeclare const rrweb: {record: Function};\n\nexport default class RecorderManager implements IPaginatorLoader<IRecordSession> {\n    readonly paginator: ItemPaginator<IRecordSession, RecorderManager>;\n    stopRecord: Function;\n\n    protected constructor(\n        protected readonly sessionWorker: SessionWorker,\n    ) {\n        this.paginator = new ItemPaginator([], this);\n    }\n\n    startRecord() {\n        ((self) => {\n            self.stopRecord = rrweb.record({\n                emit(event: IRecordEvent) {\n                    self.sessionWorker.post(event);\n                }\n            })\n        })(this);\n    }\n\n    static init(instance: string = 'BugReplay'): Promise<RecorderManager> {\n        return fetch('/vmpl-bug-report/config/worker')\n            .then(response => response.json())\n            .then((content: ConfigWorkerContent) => WorkerClient<SessionWorker>(content.assetUrl.sessionLoader))\n            .then((sessionWorker: SessionWorker) => {\n                return sessionWorker.initInstance(instance)\n                    .then(() => new RecorderManager(sessionWorker))\n            })\n    }\n\n    getEventsForSessionAt(sessions: IRecordSession[]): Promise<IRecordEvent[]> {\n        return this.sessionWorker.events(sessions)\n            .then(response => response.items);\n    }\n\n    uploadSessions(sessions?: IRecordSession[]): Promise<boolean> {\n        return this.sessionWorker.export(sessions)\n            .then(data => data.text())\n            .then(content => JSON.parse(content))\n            .then(object => console.log(object))\n            .then(() => true)\n    }\n\n    loadPaginatorItems(\n        offset: number,\n        limit: number,\n        filter: IPaginatorFilter<IRecordSession>,\n    ): Promise<IPaginatorResponse<IRecordSession>> {\n        return this.sessionWorker.sessions(offset, limit, filter);\n    }\n}\n"],"mappings":";;;MAOqBA,eAAe;IAAA;;IAIhC,SAAAA,gBACuBC,aAA4B,EACjD;MAAA,KADqBA,aAA4B,GAA5BA,aAA4B;MAE/C,IAAI,CAACC,SAAS,GAAG,IAAAC,eAAA,CAAkB,EAAE,EAAE,IAAI,CAAC;IAChD;IAAC,IAAAC,MAAA,GAAAJ,eAAA,CAAAK,SAAA;IAAAD,MAAA,CAEDE,WAAW,GAAX,SAAAA,YAAA,EAAc;MACV,CAAC,UAACC,IAAI,EAAK;QACPA,IAAI,CAACC,UAAU,GAAGC,KAAK,CAACC,MAAM,CAAC;UAC3BC,IAAI,WAAAA,KAACC,KAAmB,EAAE;YACtBL,IAAI,CAACN,aAAa,CAACY,IAAI,CAACD,KAAK,CAAC;UAClC;QACJ,CAAC,CAAC;MACN,CAAC,EAAE,IAAI,CAAC;IACZ,CAAC;IAAAZ,eAAA,CAEMc,IAAI,GAAX,SAAAA,KAAYC,QAAgB,EAA0C;MAAA,IAA1DA,QAAgB;QAAhBA,QAAgB,GAAG,WAAW;MAAA;MACtC,OAAOC,KAAK,CAAC,gCAAgC,CAAC,CACzCC,IAAI,CAAC,UAAAC,QAAQ;QAAA,OAAIA,QAAQ,CAACC,IAAI,CAAC,CAAC;MAAA,EAAC,CACjCF,IAAI,CAAC,UAACG,OAA4B;QAAA,OAAK,IAAAC,oBAAY,EAAgBD,OAAO,CAACE,QAAQ,CAACC,aAAa,CAAC;MAAA,EAAC,CACnGN,IAAI,CAAC,UAAChB,aAA4B,EAAK;QACpC,OAAOA,aAAa,CAACuB,YAAY,CAACT,QAAQ,CAAC,CACtCE,IAAI,CAAC;UAAA,OAAM,IAAIjB,eAAe,CAACC,aAAa,CAAC;QAAA,EAAC;MACvD,CAAC,CAAC;IACV,CAAC;IAAAG,MAAA,CAEDqB,qBAAqB,GAArB,SAAAA,sBAAsBC,QAA0B,EAA2B;MACvE,OAAO,IAAI,CAACzB,aAAa,CAAC0B,MAAM,CAACD,QAAQ,CAAC,CACrCT,IAAI,CAAC,UAAAC,QAAQ;QAAA,OAAIA,QAAQ,CAACU,KAAK;MAAA,EAAC;IACzC,CAAC;IAAAxB,MAAA,CAEDyB,cAAc,GAAd,SAAAA,eAAeH,QAA2B,EAAoB;MAC1D,OAAO,IAAI,CAACzB,aAAa,CAAC6B,MAAM,CAACJ,QAAQ,CAAC,CACrCT,IAAI,CAAC,UAAAc,IAAI;QAAA,OAAIA,IAAI,CAACC,IAAI,CAAC,CAAC;MAAA,EAAC,CACzBf,IAAI,CAAC,UAAAG,OAAO;QAAA,OAAIa,IAAI,CAACC,KAAK,CAACd,OAAO,CAAC;MAAA,EAAC,CACpCH,IAAI,CAAC,UAAAkB,MAAM;QAAA,OAAIC,OAAO,CAACC,GAAG,CAACF,MAAM,CAAC;MAAA,EAAC,CACnClB,IAAI,CAAC;QAAA,OAAM,IAAI;MAAA,EAAC;IACzB,CAAC;IAAAb,MAAA,CAEDkC,kBAAkB,GAAlB,SAAAA,mBACIC,MAAc,EACdC,KAAa,EACbC,MAAwC,EACG;MAC3C,OAAO,IAAI,CAACxC,aAAa,CAACyB,QAAQ,CAACa,MAAM,EAAEC,KAAK,EAAEC,MAAM,CAAC;IAC7D,CAAC;IAAA,OAAAzC,eAAA;EAAA;EAAA,OAAAA,eAAA;AAAA"}