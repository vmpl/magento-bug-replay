{"version":3,"file":"items-paginator.js","names":["CompareTypes","CompareType","_dec","workerArgument","module","id","_class","type","equal","_proto","prototype","match","item","against","in","includes","less","more","regex","test","Error","PaginatorFilter","_dec2","_class2","and","property","compare","value","groups","undefined","_proto2","append","_this$groups","push","apply","arguments","items","filter","matchItem","bind","groupsMatched","map","it","hasOwnProperty","toString","getItemValue","propertyComponents","split","itemProperty","shift","itemValue","length","join","_default","loader","_filter","_page","_size","totalRecords","_proto3","getCurrentPage","_this","offset","limit","leftChunk","slice","rightChunk","loadPaginatorItems","then","response","meta","concat","Promise","resolve","_createClass","key","set","lastPage","page","get","Object","assign"],"sources":["../../ts/js/lib/items-paginator.ts"],"sourcesContent":["import {\n    ICompare, IPaginatorFilter,\n    IPaginatorLoader,\n    PaginatorItems\n} from \"VMPL_BugReplay/js/api/paginator\";\nimport * as module from \"module\";\nimport {workerArgument} from \"VMPL_BugReplay/js/lib/worker/decorator\";\n\nenum CompareTypes {\n    equal,\n    in,\n    less,\n    more,\n    regex,\n}\n\n@workerArgument(module.id)\nexport class CompareType implements ICompare {\n    constructor(\n        protected readonly type: CompareTypes = CompareTypes.equal,\n    ) {\n        this.type = type;\n    }\n\n    match(item: any, against: any): boolean {\n        switch (this.type) {\n            case CompareTypes.equal:\n                return item == against;\n            case CompareTypes.in:\n                return against.includes(item);\n            case CompareTypes.less:\n                return item < against;\n            case CompareTypes.more:\n                return item > against;\n            case CompareTypes.regex:\n                return (<RegExp>against).test(<string>item);\n            default:\n                throw new Error(`Case not implemented: ${this.type}`);\n        }\n    }\n}\n\n@workerArgument(module.id)\nexport class PaginatorFilter implements IPaginatorFilter {\n    constructor(\n        public and: boolean = true,\n        public property: PropertyKey = null,\n        public compare: ICompare = new CompareType(CompareTypes.equal),\n        public value: any = undefined,\n        protected groups: PaginatorFilter[] = [],\n    ) {\n    }\n\n    append(...filters: [PaginatorFilter]): PaginatorFilter {\n        this.groups.push(...filters);\n        return this;\n    }\n\n    match(items: PaginatorItems): PaginatorItems {\n        return items.filter(this.matchItem.bind(this));\n    }\n\n    protected matchItem(item: Object): boolean {\n        const groupsMatched: Array<boolean> = this.groups.map(it => it.matchItem(item));\n        if (this.property) {\n            if (!item.hasOwnProperty(this.property)) {\n                throw new Error(`item do not have property named: ${this.property.toString()}`)\n            }\n            groupsMatched.push(this.compare.match(this.getItemValue(item, this.property), this.value));\n        }\n\n        return this.and\n            ? !groupsMatched.includes(false)\n            : groupsMatched.includes(true);\n    }\n\n    protected getItemValue(item: any, property: PropertyKey): any {\n        const propertyComponents = (<string>property).split('.');\n        const itemProperty = propertyComponents.shift();\n\n        const itemValue = item.hasOwnProperty(itemProperty) ? item[itemProperty] : undefined;\n        return propertyComponents.length === 0 ? itemValue : this.getItemValue(itemValue, propertyComponents.join('.'));\n    }\n}\n\nexport default class <Items extends PaginatorItems, Loader extends IPaginatorLoader> {\n    protected readonly _filter: PaginatorFilter = new PaginatorFilter();\n    protected _page: number = 1;\n    protected _size: number = 20;\n\n    protected totalRecords: number = undefined;\n\n    set page(value: number) {\n        if (!(this._page > 0)) {\n            throw new Error('Page cannot be lower then 1.');\n        }\n        if (value > this.lastPage) {\n            throw new Error('Page cannot be greater then lastPage.');\n        }\n\n        this._page = value;\n    }\n\n    set size(value: number) {\n        if (value <= 0) {\n            throw new Error('Size have to be greater then 0.');\n        }\n        if (this.totalRecords !== undefined && this.totalRecords > value) {\n            throw new Error('Size is greater then records found');\n        }\n\n        this._size = value;\n    }\n\n    set filter(value: PaginatorFilter) {\n        this.page = 1;\n        this.items = <Items>[];\n        this._filter.append(value);\n    }\n\n    get lastPage(): number {\n        let lastPage = this.totalRecords / this._size;\n        lastPage += this.totalRecords % this._size ? 1 : 0;\n        return lastPage;\n    }\n\n    constructor(\n        protected items: Items,\n        protected readonly loader: Loader,\n    ) {\n    }\n\n    getCurrentPage(): Promise<Items> {\n        const offset = (this._page - 1) * this._size;\n        const limit = this._size;\n\n        if (offset >= this.items.length) {\n            const leftChunk = <Items>this.items.slice(0, offset);\n            const rightChunk: Items = <Items>this.items.slice(offset + limit);\n            return this.loader.loadPaginatorItems(offset, limit, this._filter).then(response => {\n                this.totalRecords = response.meta.totalRecords;\n                this.items = <Items>[].concat(leftChunk, response.items, rightChunk);\n                return <Items>response.items;\n            })\n        }\n\n        return Promise.resolve(<Items>this.items.slice(offset, limit));\n    }\n}\n"],"mappings":"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"}