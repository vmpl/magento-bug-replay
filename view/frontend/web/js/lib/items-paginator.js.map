{"version":3,"file":"items-paginator.js","names":["CompareTypes","CompareType","_dec","WorkerArgument","module","id","_class","type","equal","_proto","prototype","match","item","against","in","includes","less","more","regex","test","Error","PaginatorFilter","_dec2","_class2","property","value","compare","and","groups","undefined","_proto2","append","_this$groups","push","apply","arguments","items","filter","matchItem","bind","groupsMatched","map","it","hasOwnProperty","toString","getItemValue","propertyComponents","split","itemProperty","shift","itemValue","length","join","_default","loader","_filter","_page","_size","totalRecords","_proto3","getCurrentPage","_this","offset","limit","leftChunk","slice","rightChunk","loadPaginatorItems","then","response","meta","concat","Promise","resolve","fetch","index","result","_createClass","key","set","lastPage","page","get","Object","assign"],"sources":["../../ts/js/lib/items-paginator.ts"],"sourcesContent":["import {\n    ICompare, IPaginatorFilter,\n    IPaginatorLoader,\n} from \"VMPL_BugReplay/js/api/paginator\";\nimport * as module from \"module\";\nimport {WorkerArgument} from \"VMPL_BugReplay/js/lib/worker/decorator\";\n\nenum CompareTypes {\n    equal,\n    in,\n    less,\n    more,\n    regex,\n}\n\n@WorkerArgument(module.id)\nexport class CompareType implements ICompare {\n    constructor(\n        protected readonly type: CompareTypes = CompareTypes.equal,\n    ) {\n        this.type = type;\n    }\n\n    match(item: any, against: any): boolean {\n        switch (this.type) {\n            case CompareTypes.equal:\n                return item == against;\n            case CompareTypes.in:\n                return against.includes(item);\n            case CompareTypes.less:\n                return item < against;\n            case CompareTypes.more:\n                return item > against;\n            case CompareTypes.regex:\n                return (<RegExp>against).test(<string>item);\n            default:\n                throw new Error(`Case not implemented: ${this.type}`);\n        }\n    }\n}\n\n@WorkerArgument(module.id)\nexport class PaginatorFilter<T extends Object> implements IPaginatorFilter<T> {\n    constructor(\n        public property: PropertyKey = null,\n        public value: any = undefined,\n        public compare: ICompare = new CompareType(CompareTypes.equal),\n        public and: boolean = true,\n        protected groups: PaginatorFilter<T>[] = [],\n    ) {\n    }\n\n    append(...filters: PaginatorFilter<T>[]): PaginatorFilter<T> {\n        this.groups.push(...filters);\n        return this;\n    }\n\n    match(items: Array<T>): Array<T> {\n        return items.filter(this.matchItem.bind(this));\n    }\n\n    protected matchItem(item: Object): boolean {\n        const groupsMatched: Array<boolean> = this.groups.map(it => it.matchItem(item));\n        if (this.property) {\n            if (!item.hasOwnProperty(this.property)) {\n                throw new Error(`item do not have property named: ${this.property.toString()}`)\n            }\n            groupsMatched.push(this.compare.match(this.getItemValue(item, this.property), this.value));\n        }\n\n        return this.and\n            ? !groupsMatched.includes(false)\n            : groupsMatched.includes(true);\n    }\n\n    protected getItemValue(item: any, property: PropertyKey): any {\n        const propertyComponents = (<string>property).split('.');\n        const itemProperty = propertyComponents.shift();\n\n        const itemValue = item.hasOwnProperty(itemProperty) ? item[itemProperty] : undefined;\n        return propertyComponents.length === 0 ? itemValue : this.getItemValue(itemValue, propertyComponents.join('.'));\n    }\n}\n\nexport default class <T extends Object, L extends IPaginatorLoader<T>> {\n    protected readonly _filter: PaginatorFilter<T> = new PaginatorFilter();\n    protected _page: number = 1;\n    protected _size: number = 5;\n\n    protected totalRecords: number = undefined;\n\n    set page(value: number) {\n        if (!(this._page > 0)) {\n            throw new Error('Page cannot be lower then 1.');\n        }\n        if (value > this.lastPage) {\n            throw new Error('Page cannot be greater then lastPage.');\n        }\n\n        this._page = value;\n    }\n\n    set size(value: number) {\n        if (value <= 0) {\n            throw new Error('Size have to be greater then 0.');\n        }\n        if (this.totalRecords !== undefined && this.totalRecords > value) {\n            throw new Error('Size is greater then records found');\n        }\n\n        this._size = value;\n    }\n\n    set filter(value: PaginatorFilter<T>) {\n        this.page = 1;\n        this.items = [];\n        this._filter.append(value);\n    }\n\n    get lastPage(): number {\n        let lastPage = this.totalRecords / this._size;\n        lastPage += this.totalRecords % this._size ? 1 : 0;\n        return lastPage;\n    }\n\n    constructor(\n        protected items: Array<T>,\n        protected readonly loader: L,\n    ) {\n    }\n\n    getCurrentPage(): Promise<Array<T>> {\n        const offset = (this._page - 1) * this._size;\n        const limit = this._size;\n\n        if (offset >= this.items.length) {\n            const leftChunk = <Array<T>>this.items.slice(0, offset);\n            const rightChunk = <Array<T>>this.items.slice(offset + limit);\n            return this.loader.loadPaginatorItems(offset, limit, this._filter).then(response => {\n                this.totalRecords = response.meta.totalRecords;\n                this.items = <Array<T>>[].concat(leftChunk, response.items, rightChunk);\n                return <Array<T>>response.items;\n            })\n        }\n\n        return Promise.resolve(<Array<T>>this.items.slice(offset, offset + limit));\n    }\n\n    fetch(index: number): Promise<T> {\n        return this.loader.loadPaginatorItems(index, 1, this._filter)\n            .then(result => result.items.shift());\n    }\n}\n"],"mappings":"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"}