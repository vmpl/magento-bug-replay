{"version":3,"file":"items-paginator.js","names":["CompareTypes","CompareType","_dec","serialize","_dec2","serializable","_class","_class2","type","equal","_initializerDefineProperty","_descriptor","_proto","prototype","match","item","against","in","includes","less","more","regex","test","Error","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer","PaginatorFilter","_dec3","_dec4","_class4","_class5","and","property","compare","value","groups","undefined","_descriptor2","_proto2","append","_this$groups","push","apply","arguments","items","filter","matchItem","bind","hasOwnProperty","toString","groupsMatched","map","it","getItemValue","propertyComponents","split","itemProperty","shift","itemValue","length","join","_default","loader","_filter","_page","_size","totalRecords","_proto3","getCurrentPage","_this","offset","limit","leftChunk","slice","rightChunk","loadPaginatorItems","then","response","meta","concat","Promise","resolve","_createClass","key","set","lastPage","page","get","Object","assign"],"sources":["../../ts/js/lib/items-paginator.ts"],"sourcesContent":["import {\n    ICompare, IPaginatorFilter,\n    IPaginatorLoader,\n    PaginatorItems\n} from \"VMPL_BugReplay/js/api/paginator\";\nimport {serializable, serialize} from \"VMPL_BugReplay/js/lib/decorator-serializer\";\n\nenum CompareTypes {\n    equal,\n    in,\n    less,\n    more,\n    regex,\n}\n\n@serialize()\nexport class CompareType implements ICompare {\n    @serializable() protected readonly type: CompareTypes;\n\n    constructor(\n        type: CompareTypes = CompareTypes.equal,\n    ) {\n        this.type = type;\n    }\n\n    match(item: any, against: any): boolean {\n        switch (this.type) {\n            case CompareTypes.equal:\n                return item == against;\n            case CompareTypes.in:\n                return against.includes(item);\n            case CompareTypes.less:\n                return item < against;\n            case CompareTypes.more:\n                return item > against;\n            case CompareTypes.regex:\n                return (<RegExp>against).test(<string>item);\n            default:\n                throw new Error(`Case not implemented: ${this.type}`);\n        }\n    }\n}\n\n@serialize()\nexport class PaginatorFilter implements IPaginatorFilter {\n    @serializable() public compare: ICompare;\n\n    constructor(\n        public and: boolean = true,\n        public property: PropertyKey = null,\n        compare: ICompare = new CompareType(CompareTypes.equal),\n        public value: any = undefined,\n        protected groups: PaginatorFilter[] = [],\n    ) {\n        this.compare = compare;\n    }\n\n    append(...filters: [PaginatorFilter]): PaginatorFilter {\n        this.groups.push(...filters);\n        return this;\n    }\n\n    match(items: PaginatorItems): PaginatorItems {\n        return items.filter(this.matchItem.bind(this));\n    }\n\n    protected matchItem(item: Object): boolean {\n        if (!item.hasOwnProperty(this.property)) {\n            throw new Error(`item do not have property named: ${this.property.toString()}`)\n        }\n\n        const groupsMatched: Array<boolean> = this.groups.map(it => it.matchItem(item));\n        groupsMatched.push(this.compare.match(this.getItemValue(item, this.property), this.value));\n\n        return this.and\n            ? !groupsMatched.includes(false)\n            : groupsMatched.includes(true);\n    }\n\n    protected getItemValue(item: any, property: PropertyKey): any {\n        const propertyComponents = (<string>property).split('.');\n        const itemProperty = propertyComponents.shift();\n\n        const itemValue = item.hasOwnProperty(itemProperty) ? item[itemProperty] : undefined;\n        return propertyComponents.length === 0 ? itemValue : this.getItemValue(itemValue, propertyComponents.join('.'));\n    }\n}\n\nexport default class <Items extends PaginatorItems, Loader extends IPaginatorLoader> {\n    protected readonly _filter: PaginatorFilter = new PaginatorFilter();\n    protected _page: number = 1;\n    protected _size: number = 20;\n\n    protected totalRecords: number = undefined;\n\n    set page(value: number) {\n        if (!(this._page > 0)) {\n            throw new Error('Page cannot be lower then 1.');\n        }\n        if (value > this.lastPage) {\n            throw new Error('Page cannot be greater then lastPage.');\n        }\n\n        this._page = value;\n    }\n\n    set size(value: number) {\n        if (value <= 0) {\n            throw new Error('Size have to be greater then 0.');\n        }\n        if (this.totalRecords !== undefined && this.totalRecords > value) {\n            throw new Error('Size is greater then records found');\n        }\n\n        this._size = value;\n    }\n\n    set filter(value: PaginatorFilter) {\n        this.page = 1;\n        this.items = <Items>[];\n        this._filter.append(value);\n    }\n\n    get lastPage(): number {\n        let lastPage = this.totalRecords / this._size;\n        lastPage += this.totalRecords % this._size ? 1 : 0;\n        return lastPage;\n    }\n\n    constructor(\n        protected items: Items,\n        protected readonly loader: Loader,\n    ) {\n    }\n\n    getCurrentPage(): Promise<Items> {\n        const offset = (this._page - 1) * this._size;\n        const limit = this._size;\n\n        if (offset >= this.items.length) {\n            const leftChunk = <Items>this.items.slice(0, offset);\n            const rightChunk: Items = <Items>this.items.slice(offset + limit);\n            return this.loader.loadPaginatorItems(offset, limit, this._filter).then(response => {\n                this.totalRecords = response.meta.totalRecords;\n                this.items = <Items>[].concat(leftChunk, response.items, rightChunk);\n                return <Items>response.items;\n            })\n        }\n\n        return Promise.resolve(<Items>this.items.slice(offset, limit));\n    }\n}\n"],"mappings":"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"}