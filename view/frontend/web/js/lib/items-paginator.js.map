{"version":3,"file":"items-paginator.js","names":["CompareTypes","CompareType","_dec","serializable","_class","type","_initializerDefineProperty","_descriptor","_proto","prototype","match","item","against","equal","in","includes","less","more","regex","test","Error","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer","PaginatorFilter","_dec2","_dec3","_dec4","_dec5","_dec6","_class3","_Object","_inheritsLoose","and","property","compare","value","groups","_this","undefined","call","_assertThisInitialized","_descriptor2","_descriptor3","_descriptor4","_descriptor5","_descriptor6","_proto2","append","_this$groups","push","apply","arguments","items","filter","matchItem","bind","hasOwnProperty","toString","groupsMatched","map","it","getItemValue","propertyComponents","split","itemProperty","shift","itemValue","length","join","_wrapNativeSuper","Object","_default","loader","_filter","_page","_size","totalRecords","_proto3","getCurrentPage","_this2","offset","limit","leftChunk","slice","rightChunk","loadPaginatorItems","then","response","meta","concat","Promise","resolve","_createClass","key","set","lastPage","page","get","assign"],"sources":["../../ts/js/lib/items-paginator.ts"],"sourcesContent":["import {\n    ICompare, IPaginatorFilter,\n    IPaginatorLoader,\n    PaginatorItems\n} from \"VMPL_BugReplay/js/api/paginator\";\nimport {serializable} from \"VMPL_BugReplay/js/lib/worker-serializer\";\n\nenum CompareTypes {\n    equal,\n    in,\n    less,\n    more,\n    regex,\n}\n\nexport class CompareType implements ICompare {\n    @serializable() protected readonly type: CompareTypes;\n\n    constructor(\n        type: CompareTypes,\n    ) {\n        this.type = type;\n    }\n\n    match(item: any, against: any): boolean {\n        switch (this.type) {\n            case CompareTypes.equal:\n                return item == against;\n            case CompareTypes.in:\n                return against.includes(item);\n            case CompareTypes.less:\n                return item < against;\n            case CompareTypes.more:\n                return item > against;\n            case CompareTypes.regex:\n                return (<RegExp>against).test(<string>item);\n            default:\n                throw new Error(`Case not implemented: ${this.type}`);\n        }\n    }\n}\n\nexport class PaginatorFilter extends Object implements IPaginatorFilter {\n    @serializable() public and: boolean;\n    @serializable() public property: PropertyKey;\n    @serializable() public compare: ICompare;\n    @serializable() public value: any;\n    @serializable() protected groups: PaginatorFilter[];\n\n    constructor(\n        and: boolean = true,\n        property: PropertyKey = null,\n        compare: ICompare = new CompareType(CompareTypes.equal),\n        value: any = undefined,\n        groups: PaginatorFilter[] = [],\n    ) {\n        super();\n        this.groups = groups;\n        this.value = value;\n        this.compare = compare;\n        this.property = property;\n        this.and = and;\n    }\n\n    append(...filters: [PaginatorFilter]): PaginatorFilter {\n        this.groups.push(...filters);\n        return this;\n    }\n\n    match(items: PaginatorItems): PaginatorItems {\n        return items.filter(this.matchItem.bind(this));\n    }\n\n    protected matchItem(item: Object): boolean {\n        if (!item.hasOwnProperty(this.property)) {\n            throw new Error(`item do not have property named: ${this.property.toString()}`)\n        }\n\n        const groupsMatched: Array<boolean> = this.groups.map(it => it.matchItem(item));\n        groupsMatched.push(this.compare.match(this.getItemValue(item, this.property), this.value));\n\n        return this.and\n            ? !groupsMatched.includes(false)\n            : groupsMatched.includes(true);\n    }\n\n    protected getItemValue(item: any, property: PropertyKey): any {\n        const propertyComponents = (<string>property).split('.');\n        const itemProperty = propertyComponents.shift();\n\n        const itemValue = item.hasOwnProperty(itemProperty) ? item[itemProperty] : undefined;\n        return propertyComponents.length === 0 ? itemValue : this.getItemValue(itemValue, propertyComponents.join('.'));\n    }\n}\n\nexport default class <Items extends PaginatorItems, Loader extends IPaginatorLoader> {\n    protected readonly _filter: PaginatorFilter = new PaginatorFilter();\n    protected _page: number = 1;\n    protected _size: number = 20;\n\n    protected totalRecords: number = undefined;\n\n    set page(value: number) {\n        if (!(this._page > 0)) {\n            throw new Error('Page cannot be lower then 1.');\n        }\n        if (value > this.lastPage) {\n            throw new Error('Page cannot be greater then lastPage.');\n        }\n\n        this._page = value;\n    }\n\n    set size(value: number) {\n        if (value <= 0) {\n            throw new Error('Size have to be greater then 0.');\n        }\n        if (this.totalRecords !== undefined && this.totalRecords > value) {\n            throw new Error('Size is greater then records found');\n        }\n\n        this._size = value;\n    }\n\n    set filter(value: PaginatorFilter) {\n        this.page = 1;\n        this.items = <Items>[];\n        this._filter.append(value);\n    }\n\n    get lastPage(): number {\n        let lastPage = this.totalRecords / this._size;\n        lastPage += this.totalRecords % this._size ? 1 : 0;\n        return lastPage;\n    }\n\n    constructor(\n        protected items: Items,\n        protected readonly loader: Loader,\n    ) {\n    }\n\n    getCurrentPage(): Promise<Items> {\n        const offset = (this._page - 1) * this._size;\n        const limit = this._size;\n\n        if (offset >= this.items.length) {\n            const leftChunk = <Items>this.items.slice(0, offset);\n            const rightChunk: Items = <Items>this.items.slice(offset + limit);\n            return this.loader.loadPaginatorItems(offset, limit, this._filter).then(response => {\n                this.totalRecords = response.meta.totalRecords;\n                this.items = <Items>[].concat(leftChunk, response.items, rightChunk);\n                return <Items>response.items;\n            })\n        }\n\n        return Promise.resolve(<Items>this.items.slice(offset, limit));\n    }\n}\n"],"mappings":"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"}