{"version":3,"file":"client.js","names":["WorkerClient","scriptUrl","worker","Worker","Promise","resolve","addEventListener","event","methods","data","arguments","Object","fromEntries","map","method","listener","_converter","objectToClass","then","once","passive","_len","length","args","Array","_key","all","classToObject","bind","resolved","postMessage"],"sources":["../../../ts/js/lib/worker/client.ts"],"sourcesContent":["import {IMessageWorker} from \"VMPL_BugReplay/js/api/worker\";\nimport Converter from \"VMPL_BugReplay/js/lib/worker/converter\";\n\nexport function WorkerClient<T>(scriptUrl: string): Promise<T> {\n    const worker = new Worker(scriptUrl);\n\n    return new Promise(resolve => {\n        worker.addEventListener('message', (event: MessageEvent<IMessageWorker>) => {\n            const methods = event.data.arguments;\n            resolve(Object.fromEntries(methods.map(method => {\n                return [method, (...args: any[]) => {\n                    const listener = new Promise(resolve => {\n                        worker.addEventListener('message', (event) => {\n                            Converter.objectToClass(event.data)\n                                .then(data => resolve(data))\n                        }, {once: true, passive: true});\n                    })\n\n                    Promise.all(args.map(Converter.classToObject.bind(Converter)))\n                        .then(resolved => worker.postMessage(<IMessageWorker>{\n                            method,\n                            arguments: resolved\n                        }));\n\n                    return listener;\n                }];\n            })))\n        }, {once: true});\n    });\n}\n"],"mappings":";;;EAGO,SAASA,YAAYA,CAAIC,SAAiB,EAAc;IAC3D,IAAMC,MAAM,GAAG,IAAIC,MAAM,CAACF,SAAS,CAAC;IAEpC,OAAO,IAAIG,OAAO,CAAC,UAAAC,OAAO,EAAI;MAC1BH,MAAM,CAACI,gBAAgB,CAAC,SAAS,EAAE,UAACC,KAAmC,EAAK;QACxE,IAAMC,OAAO,GAAGD,KAAK,CAACE,IAAI,CAACC,SAAS;QACpCL,OAAO,CAACM,MAAM,CAACC,WAAW,CAACJ,OAAO,CAACK,GAAG,CAAC,UAAAC,MAAM,EAAI;UAC7C,OAAO,CAACA,MAAM,EAAE,YAAoB;YAChC,IAAMC,QAAQ,GAAG,IAAIX,OAAO,CAAC,UAAAC,OAAO,EAAI;cACpCH,MAAM,CAACI,gBAAgB,CAAC,SAAS,EAAE,UAACC,KAAK,EAAK;gBAC1CS,UAAA,CAAUC,aAAa,CAACV,KAAK,CAACE,IAAI,CAAC,CAC9BS,IAAI,CAAC,UAAAT,IAAI;kBAAA,OAAIJ,OAAO,CAACI,IAAI,CAAC;gBAAA,EAAC;cACpC,CAAC,EAAE;gBAACU,IAAI,EAAE,IAAI;gBAAEC,OAAO,EAAE;cAAI,CAAC,CAAC;YACnC,CAAC,CAAC;YAAA,SAAAC,IAAA,GAAAX,SAAA,CAAAY,MAAA,EANcC,IAAI,OAAAC,KAAA,CAAAH,IAAA,GAAAI,IAAA,MAAAA,IAAA,GAAAJ,IAAA,EAAAI,IAAA;cAAJF,IAAI,CAAAE,IAAA,IAAAf,SAAA,CAAAe,IAAA;YAAA;YAQpBrB,OAAO,CAACsB,GAAG,CAACH,IAAI,CAACV,GAAG,CAACG,UAAA,CAAUW,aAAa,CAACC,IAAI,CAAAZ,UAAU,CAAC,CAAC,CAAC,CACzDE,IAAI,CAAC,UAAAW,QAAQ;cAAA,OAAI3B,MAAM,CAAC4B,WAAW,CAAiB;gBACjDhB,MAAM,EAANA,MAAM;gBACNJ,SAAS,EAAEmB;cACf,CAAC,CAAC;YAAA,EAAC;YAEP,OAAOd,QAAQ;UACnB,CAAC,CAAC;QACN,CAAC,CAAC,CAAC,CAAC;MACR,CAAC,EAAE;QAACI,IAAI,EAAE;MAAI,CAAC,CAAC;IACpB,CAAC,CAAC;EACN;EAAC;IAAAnB,YAAA,EAAAA;EAAA;AAAA"}