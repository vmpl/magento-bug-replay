{"version":3,"file":"client.js","names":["WorkerClient","scriptUrl","worker","Worker","Promise","resolve","addEventListener","event","methods","data","arguments","Object","fromEntries","map","method","listener","once","passive","_len","length","args","Array","_key","all","_converter","classToObject","bind","then","resolved","postMessage"],"sources":["../../../ts/js/lib/worker/client.ts"],"sourcesContent":["import {IMessageWorker} from \"VMPL_BugReplay/js/lib/worker/api\";\nimport Converter from \"VMPL_BugReplay/js/lib/worker/converter\";\n\nexport function WorkerClient<T>(scriptUrl: string): Promise<T> {\n    const worker = new Worker(scriptUrl);\n\n    return new Promise(resolve => {\n        worker.addEventListener('message', (event: MessageEvent<IMessageWorker>) => {\n            const methods = event.data.arguments;\n            resolve(Object.fromEntries(methods.map(method => {\n                return [method, (...args: any[]) => {\n                    const listener = new Promise(resolve => {\n                        worker.addEventListener('message', (event) => {\n                            resolve(event.data);\n                        }, {once: true, passive: true});\n                    })\n\n                    Promise.all(args.map(Converter.classToObject.bind(Converter)))\n                        .then(resolved => worker.postMessage(<IMessageWorker>{\n                            method,\n                            arguments: resolved\n                        }));\n\n                    return listener;\n                }];\n            })))\n        }, {once: true});\n    });\n}\n"],"mappings":";;;EAGO,SAASA,YAAYA,CAAIC,SAAiB,EAAc;IAC3D,IAAMC,MAAM,GAAG,IAAIC,MAAM,CAACF,SAAS,CAAC;IAEpC,OAAO,IAAIG,OAAO,CAAC,UAAAC,OAAO,EAAI;MAC1BH,MAAM,CAACI,gBAAgB,CAAC,SAAS,EAAE,UAACC,KAAmC,EAAK;QACxE,IAAMC,OAAO,GAAGD,KAAK,CAACE,IAAI,CAACC,SAAS;QACpCL,OAAO,CAACM,MAAM,CAACC,WAAW,CAACJ,OAAO,CAACK,GAAG,CAAC,UAAAC,MAAM,EAAI;UAC7C,OAAO,CAACA,MAAM,EAAE,YAAoB;YAChC,IAAMC,QAAQ,GAAG,IAAIX,OAAO,CAAC,UAAAC,OAAO,EAAI;cACpCH,MAAM,CAACI,gBAAgB,CAAC,SAAS,EAAE,UAACC,KAAK,EAAK;gBAC1CF,OAAO,CAACE,KAAK,CAACE,IAAI,CAAC;cACvB,CAAC,EAAE;gBAACO,IAAI,EAAE,IAAI;gBAAEC,OAAO,EAAE;cAAI,CAAC,CAAC;YACnC,CAAC,CAAC;YAAA,SAAAC,IAAA,GAAAR,SAAA,CAAAS,MAAA,EALcC,IAAI,OAAAC,KAAA,CAAAH,IAAA,GAAAI,IAAA,MAAAA,IAAA,GAAAJ,IAAA,EAAAI,IAAA;cAAJF,IAAI,CAAAE,IAAA,IAAAZ,SAAA,CAAAY,IAAA;YAAA;YAOpBlB,OAAO,CAACmB,GAAG,CAACH,IAAI,CAACP,GAAG,CAACW,UAAA,CAAUC,aAAa,CAACC,IAAI,CAAAF,UAAU,CAAC,CAAC,CAAC,CACzDG,IAAI,CAAC,UAAAC,QAAQ;cAAA,OAAI1B,MAAM,CAAC2B,WAAW,CAAiB;gBACjDf,MAAM,EAANA,MAAM;gBACNJ,SAAS,EAAEkB;cACf,CAAC,CAAC;YAAA,EAAC;YAEP,OAAOb,QAAQ;UACnB,CAAC,CAAC;QACN,CAAC,CAAC,CAAC,CAAC;MACR,CAAC,EAAE;QAACC,IAAI,EAAE;MAAI,CAAC,CAAC;IACpB,CAAC,CAAC;EACN;EAAC;IAAAhB,YAAA,EAAAA;EAAA;AAAA"}