{"version":3,"file":"database.js","names":["Database","_dexie$Dexie","_inheritsLoose","databaseName","_this","call","addons","_dexieRelationships","mapFirstVersion","sessions","mapToClass","RecordSession","events","RecordEvent","buffer","_proto","prototype","export","_export","options","exportDB","version","stores","Dexie"],"sources":["../../../ts/js/lib/session/database.ts"],"sourcesContent":["import {Dexie} from \"dexie\";\nimport {exportDB, ExportOptions} from \"dexie-export-import\";\nimport relationships from \"dexie-relationships\";\nimport {IRecordEvent, IRecordSession} from \"VMPL_BugReplay/js/api/session\";\nimport {RecordEvent} from \"VMPL_BugReplay/js/lib/session/model/record-event\";\nimport {RecordSession} from \"VMPL_BugReplay/js/lib/session/model/record-session\";\n\nexport default class Database extends Dexie {\n    sessions!: Dexie.Table<IRecordSession, number>;\n    events!: Dexie.Table<IRecordEvent, number>;\n    buffer!: Dexie.Table<IRecordEvent, number>;\n\n    constructor(databaseName: string) {\n        super(databaseName, {addons: [relationships]});\n        this.mapFirstVersion();\n        this.sessions.mapToClass(RecordSession);\n        this.events.mapToClass(RecordEvent);\n        this.buffer.mapToClass(RecordEvent);\n    }\n\n    export(options?: ExportOptions): Promise<Blob> {\n        return exportDB(this, options);\n    }\n\n    private mapFirstVersion() {\n        this.version(1).stores({\n            sessions: '++id,&timestamp,href,title',\n            events: '&timestamp,*type,data,sessionId -> sessions.id',\n            buffer: '&timestamp,*type,data',\n        });\n    }\n}\n"],"mappings":";;;;;MAOqBA,QAAQ,0BAAAC,YAAA;IAAA;;IAAAC,cAAA,CAAAF,QAAA,EAAAC,YAAA;IAKzB,SAAAD,SAAYG,YAAoB,EAAE;MAAA,IAAAC,KAAA;MAC9BA,KAAA,GAAAH,YAAA,CAAAI,IAAA,OAAMF,YAAY,EAAE;QAACG,MAAM,EAAE,CAAAC,mBAAA;MAAe,CAAC,CAAC;MAC9CH,KAAA,CAAKI,eAAe,CAAC,CAAC;MACtBJ,KAAA,CAAKK,QAAQ,CAACC,UAAU,CAACC,4BAAa,CAAC;MACvCP,KAAA,CAAKQ,MAAM,CAACF,UAAU,CAACG,wBAAW,CAAC;MACnCT,KAAA,CAAKU,MAAM,CAACJ,UAAU,CAACG,wBAAW,CAAC;MAAC,OAAAT,KAAA;IACxC;IAAC,IAAAW,MAAA,GAAAf,QAAA,CAAAgB,SAAA;IAAAD,MAAA,CAEDE,MAAM,GAAN,SAAAC,QAAOC,OAAuB,EAAiB;MAC3C,OAAO,IAAAC,2BAAQ,EAAC,IAAI,EAAED,OAAO,CAAC;IAClC,CAAC;IAAAJ,MAAA,CAEOP,eAAe,GAAvB,SAAAA,gBAAA,EAA0B;MACtB,IAAI,CAACa,OAAO,CAAC,CAAC,CAAC,CAACC,MAAM,CAAC;QACnBb,QAAQ,EAAE,4BAA4B;QACtCG,MAAM,EAAE,gDAAgD;QACxDE,MAAM,EAAE;MACZ,CAAC,CAAC;IACN,CAAC;IAAA,OAAAd,QAAA;EAAA,EAvBiCuB,YAAK;EAAA,OAAAvB,QAAA;AAAA"}