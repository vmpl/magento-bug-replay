{"version":3,"file":"session-worker.js","names":["SessionDatabase","_dexie$Dexie","_inheritsLoose","databaseName","_this","call","version","stores","events","_proto","prototype","postRecord","record","add","Dexie","SessionWorker","_proto2","exportToObject","initInstance","bind","post","instance","database","Promise","resolve","event","then","sessionWorker","expose"],"sources":["../../ts/js/worker/session-worker.ts"],"sourcesContent":["import {expose} from 'threads/worker';\nimport {Dexie} from 'dexie';\nimport {RecordEvent, SessionWorker as SessionWorkerInterface} from 'VMPL_BugReplay/js/api/session'\n\nclass SessionDatabase extends Dexie {\n    events!: Dexie.Table<RecordEvent, number>;\n\n    constructor(databaseName: string) {\n        super(databaseName);\n        this.version(1).stores({\n            events: 'timestamp,type,data',\n        });\n    }\n\n    postRecord(record: RecordEvent): Promise<RecordEvent> {\n        return this.events.add(record);\n    }\n}\n\nclass SessionWorker implements SessionWorkerInterface {\n    protected database: SessionDatabase;\n\n    exportToObject(): Object {\n        return {\n            initInstance: this.initInstance.bind(this),\n            post: this.post.bind(this),\n        }\n    }\n    initInstance(instance: string): Promise<any> {\n        this.database = new SessionDatabase(instance);\n        return Promise.resolve();\n    }\n\n    post(event: RecordEvent): Promise<boolean> {\n        return this.database.postRecord(event)\n            .then(() => true);\n    }\n}\nconst sessionWorker = new SessionWorker();\n\nexpose(sessionWorker.exportToObject());\n"],"mappings":";;;;;;;MAIMA,eAAe,0BAAAC,YAAA;IAAAC,cAAA,CAAAF,eAAA,EAAAC,YAAA;IAGjB,SAAAD,gBAAYG,YAAoB,EAAE;MAAA,IAAAC,KAAA;MAC9BA,KAAA,GAAAH,YAAA,CAAAI,IAAA,OAAMF,YAAY,CAAC;MACnBC,KAAA,CAAKE,OAAO,CAAC,CAAC,CAAC,CAACC,MAAM,CAAC;QACnBC,MAAM,EAAE;MACZ,CAAC,CAAC;MAAC,OAAAJ,KAAA;IACP;IAAC,IAAAK,MAAA,GAAAT,eAAA,CAAAU,SAAA;IAAAD,MAAA,CAEDE,UAAU,GAAV,SAAAA,WAAWC,MAAmB,EAAwB;MAClD,OAAO,IAAI,CAACJ,MAAM,CAACK,GAAG,CAACD,MAAM,CAAC;IAClC,CAAC;IAAA,OAAAZ,eAAA;EAAA,EAZyBc,YAAK;EAAA,IAe7BC,aAAa;IAAA,SAAAA,cAAA;IAAA,IAAAC,OAAA,GAAAD,aAAA,CAAAL,SAAA;IAAAM,OAAA,CAGfC,cAAc,GAAd,SAAAA,eAAA,EAAyB;MACrB,OAAO;QACHC,YAAY,EAAE,IAAI,CAACA,YAAY,CAACC,IAAI,CAAC,IAAI,CAAC;QAC1CC,IAAI,EAAE,IAAI,CAACA,IAAI,CAACD,IAAI,CAAC,IAAI;MAC7B,CAAC;IACL,CAAC;IAAAH,OAAA,CACDE,YAAY,GAAZ,SAAAA,aAAaG,QAAgB,EAAgB;MACzC,IAAI,CAACC,QAAQ,GAAG,IAAItB,eAAe,CAACqB,QAAQ,CAAC;MAC7C,OAAOE,OAAO,CAACC,OAAO,CAAC,CAAC;IAC5B,CAAC;IAAAR,OAAA,CAEDI,IAAI,GAAJ,SAAAA,KAAKK,KAAkB,EAAoB;MACvC,OAAO,IAAI,CAACH,QAAQ,CAACX,UAAU,CAACc,KAAK,CAAC,CACjCC,IAAI,CAAC;QAAA,OAAM,IAAI;MAAA,EAAC;IACzB,CAAC;IAAA,OAAAX,aAAA;EAAA;EAEL,IAAMY,aAAa,GAAG,IAAIZ,aAAa,CAAC,CAAC;EAEzC,IAAAa,cAAM,EAACD,aAAa,CAACV,cAAc,CAAC,CAAC,CAAC;AAAC"}