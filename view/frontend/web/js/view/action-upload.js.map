{"version":3,"file":"action-upload.js","names":["_uiComponent","extend","visibility","_knockout","observable","sessions","observableArray","defaults","template","submitLabel","_translate","modules","list","imports","manager","initObservable","_this","_super","subscribe","Object","values","forEach","session","upload","onSessionUploadChange","bind","uploadChecked","some","it","onSubmit","target","event","_this2","stopPropagation","thenManager","filter","then","uploadSessions","onCancel","reload","_default"],"sources":["../../ts/js/view/action-upload.ts"],"sourcesContent":["import Component from \"uiComponent\";\nimport ko from 'knockout';\nimport ItemSession from \"VMPL_BugReplay/js/model/item-session\";\nimport $t from 'mage/translate';\nimport RecorderManager from \"VMPL_BugReplay/js/bug-replay/recorder-manager\";\n\nexport default Component.extend({\n    visibility: ko.observable<boolean>(false),\n    sessions: ko.observableArray<ItemSession>(),\n    defaults: {\n        template: 'VMPL_BugReplay/player/mass-action',\n        submitLabel: $t('Upload'),\n        modules: {\n            list: 'player.sidebar.list',\n        },\n        imports: {\n            sessions: '${ $.provider }:sessions',\n            manager: '${ $.provider }:manager',\n        },\n    },\n    initObservable() {\n        this._super();\n\n        this.sessions.subscribe((sessions: { [index: number]: ItemSession }) => {\n            Object.values(sessions)\n                .forEach(session => {\n                    session.upload.subscribe(this.onSessionUploadChange.bind(this));\n                })\n        })\n\n        return this;\n    },\n    onSessionUploadChange() {\n        const sessions: { [index: number]: ItemSession } = this.sessions();\n        const uploadChecked = Object.values(sessions).some(it => it.upload());\n        this.visibility(uploadChecked);\n    },\n    onSubmit(target: any, event: MouseEvent) {\n        event.stopPropagation();\n\n        const thenManager: Promise<RecorderManager> = this.manager();\n        const sessions = Object.values<ItemSession>(this.sessions()).filter((it: ItemSession) => it.upload());\n        thenManager\n            .then(manager => manager.uploadSessions(sessions))\n            .then(() => {\n                this.onCancel();\n                return this.list().reload()\n            })\n    },\n    onCancel() {\n        Object.values(this.sessions())\n            .forEach((session: ItemSession) => session.upload(false));\n    }\n});\n"],"mappings":";;;iBAMeA,YAAA,CAAUC,MAAM,CAAC;IAC5BC,UAAU,EAAEC,SAAA,CAAGC,UAAU,CAAU,KAAK,CAAC;IACzCC,QAAQ,EAAEF,SAAA,CAAGG,eAAe,CAAc,CAAC;IAC3CC,QAAQ,EAAE;MACNC,QAAQ,EAAE,mCAAmC;MAC7CC,WAAW,EAAE,IAAAC,UAAA,EAAG,QAAQ,CAAC;MACzBC,OAAO,EAAE;QACLC,IAAI,EAAE;MACV,CAAC;MACDC,OAAO,EAAE;QACLR,QAAQ,EAAE,0BAA0B;QACpCS,OAAO,EAAE;MACb;IACJ,CAAC;IACDC,cAAc,WAAAA,eAAA,EAAG;MAAA,IAAAC,KAAA;MACb,IAAI,CAACC,MAAM,CAAC,CAAC;MAEb,IAAI,CAACZ,QAAQ,CAACa,SAAS,CAAC,UAACb,QAA0C,EAAK;QACpEc,MAAM,CAACC,MAAM,CAACf,QAAQ,CAAC,CAClBgB,OAAO,CAAC,UAAAC,OAAO,EAAI;UAChBA,OAAO,CAACC,MAAM,CAACL,SAAS,CAACF,KAAI,CAACQ,qBAAqB,CAACC,IAAI,CAACT,KAAI,CAAC,CAAC;QACnE,CAAC,CAAC;MACV,CAAC,CAAC;MAEF,OAAO,IAAI;IACf,CAAC;IACDQ,qBAAqB,WAAAA,sBAAA,EAAG;MACpB,IAAMnB,QAA0C,GAAG,IAAI,CAACA,QAAQ,CAAC,CAAC;MAClE,IAAMqB,aAAa,GAAGP,MAAM,CAACC,MAAM,CAACf,QAAQ,CAAC,CAACsB,IAAI,CAAC,UAAAC,EAAE;QAAA,OAAIA,EAAE,CAACL,MAAM,CAAC,CAAC;MAAA,EAAC;MACrE,IAAI,CAACrB,UAAU,CAACwB,aAAa,CAAC;IAClC,CAAC;IACDG,QAAQ,WAAAA,SAACC,MAAW,EAAEC,KAAiB,EAAE;MAAA,IAAAC,MAAA;MACrCD,KAAK,CAACE,eAAe,CAAC,CAAC;MAEvB,IAAMC,WAAqC,GAAG,IAAI,CAACpB,OAAO,CAAC,CAAC;MAC5D,IAAMT,QAAQ,GAAGc,MAAM,CAACC,MAAM,CAAc,IAAI,CAACf,QAAQ,CAAC,CAAC,CAAC,CAAC8B,MAAM,CAAC,UAACP,EAAe;QAAA,OAAKA,EAAE,CAACL,MAAM,CAAC,CAAC;MAAA,EAAC;MACrGW,WAAW,CACNE,IAAI,CAAC,UAAAtB,OAAO;QAAA,OAAIA,OAAO,CAACuB,cAAc,CAAChC,QAAQ,CAAC;MAAA,EAAC,CACjD+B,IAAI,CAAC,YAAM;QACRJ,MAAI,CAACM,QAAQ,CAAC,CAAC;QACf,OAAON,MAAI,CAACpB,IAAI,CAAC,CAAC,CAAC2B,MAAM,CAAC,CAAC;MAC/B,CAAC,CAAC;IACV,CAAC;IACDD,QAAQ,WAAAA,SAAA,EAAG;MACPnB,MAAM,CAACC,MAAM,CAAC,IAAI,CAACf,QAAQ,CAAC,CAAC,CAAC,CACzBgB,OAAO,CAAC,UAACC,OAAoB;QAAA,OAAKA,OAAO,CAACC,MAAM,CAAC,KAAK,CAAC;MAAA,EAAC;IACjE;EACJ,CAAC,CAAC;EAAA,OAAAiB,QAAA;AAAA"}