{"version":3,"file":"provider.js","names":["_default","_uiComponent","extend","defaults","fileHash","ignoreTmpls","data","modules","player","initialize","options","_this","_super","manager","_manager","then","startRecord","exposeDemoActions","_set","_recorderManager","init","set","path","value","_this2","Array","_this$get","Object","keys","get","filter","index","length","forEach","remove","$$primary","Function","diffs","isTracked","_mageUtils","compare","_notifyChanges","pathComponent","parent","pathComponents","split","lastPathComponent","pop","shift","_underscore","isObject","isFunction","range","from","to","i","push","window","demo","getSessionRecords","paginator","item","console","log","goForPage","page","addFilterWithTitle","title","PaginatorFilter","getTwoFirstSessionEvents","Promise","all","map","it","fetch","sessions","getEventsForSessionAt","events","uploadSessions","deleteFirstSession","deleteAt","deleteAllSessions"],"sources":["../../ts/js/model/provider.ts"],"sourcesContent":["// @ts-ignore\nimport utils from 'mageUtils';\nimport _ from 'underscore';\nimport Component from 'uiComponent';\nimport RecorderManager from \"VMPL_BugReplay/js/lib/recorder-manager\";\nimport {PaginatorFilter} from \"VMPL_BugReplay/js/lib/items-paginator\";\n\nexport default Component.extend({\n    defaults: {\n        fileHash: 'BugReplay',\n        ignoreTmpls: {\n            data: true\n        },\n        modules: {\n            player: 'player',\n        },\n    },\n    initialize(options: object) {\n        this._super(options);\n\n        const manager = this._manager()\n            .then((manager: RecorderManager) => {\n                if (!this.player()) {\n                    manager.startRecord();\n                }\n                this.exposeDemoActions(manager);\n\n                return manager;\n            })\n        this._set('manager', () => manager)\n\n        return this;\n    },\n    _manager() {\n        return RecorderManager.init('/vmpl-bug-report/worker/loader', this.fileHash);\n    },\n    set(path: string, value: any) {\n        if (value instanceof Array) {\n            Object.keys(this.get(path) ?? {})\n                .filter(index => ~~index >= value.length)\n                .forEach(index => this.remove(`${path}.${index}`));\n\n            for (let index in value) {\n                this.set(`${path}.${index}`, value[index]);\n            }\n\n            return this;\n        }\n\n        // @docs prevents the loop of the same item\n        if (!(value.$$primary instanceof Function)) {\n            return this._super(path, value);\n        }\n\n        const data = this.get(path);\n        const diffs = !(data instanceof Function)\n            && !this.isTracked(data)\n            && data?.$$primary() !== value.$$primary()\n                ? utils.compare(data, value, path)\n                : false;\n        this._set(path ,value);\n\n        if (diffs) {\n            this._notifyChanges(diffs);\n        }\n\n        return this;\n    },\n    _set(path: string, value: any) {\n        let pathComponent, parent = this;\n        const pathComponents = path.split('.');\n        const lastPathComponent = pathComponents.pop();\n        while(pathComponent = pathComponents.shift()) {\n            if (!_.isObject(parent[pathComponent])) {\n                parent[pathComponent] = {};\n            }\n            parent = parent[pathComponent];\n        }\n        if (_.isFunction(parent[lastPathComponent])) {\n            parent[lastPathComponent](value);\n        } else {\n            parent[lastPathComponent] = value;\n        }\n    },\n    exposeDemoActions(manager: RecorderManager) {\n        const range = (from: number, to: number) => {\n            const range = [];\n            for (let i = from; i < to; i++) {\n                range.push(i);\n            }\n            return range;\n        }\n\n        // @ts-ignore\n        window.demo = {\n            startRecord: () => {\n                manager.startRecord()\n            },\n            getSessionRecords: () => {\n                manager.paginator.forEach((item) => {\n                    console.log(item)\n                });\n            },\n            goForPage: (value: number) => (manager.paginator.page = value),\n            addFilterWithTitle: (title: string = 'Jackets - Tops - Women') => {\n                manager.paginator.filter = new PaginatorFilter('title', title);\n            },\n            getTwoFirstSessionEvents: (from: number = 0, to: number = 2) => {\n                Promise.all(range(from, to).map(it => manager.paginator.fetch(it)))\n                    .then(sessions => manager.getEventsForSessionAt(sessions))\n                    .then(events => console.log(events))\n            },\n            uploadSessions: () => {\n                manager.paginator.all()\n                    .then(sessions => {\n                        return manager.uploadSessions(sessions);\n                    })\n                    .then(() => console.log('finished'));\n            },\n            deleteFirstSession: () => {\n                manager.deleteAt(0)\n                    .then(() => console.log('deleted'));\n            },\n            deleteAllSessions: () => {\n                manager.paginator.forEach((item, index) => {\n                    manager.deleteAt(index);\n                })\n                    .then(() => console.log('deletedAll'))\n            }\n        }\n    }\n})\n"],"mappings":"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"}