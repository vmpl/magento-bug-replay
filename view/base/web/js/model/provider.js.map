{"version":3,"file":"provider.js","names":["_default","_uiComponent","extend","defaults","fileHash","endpointRequest","ignoreTmpls","data","initialize","options","_super","get","undefined","set","manager","_manager","_set","_this","_recorderManager","init","then","shouldRecord","startRecord","path","startsWith","storage","replace","_this$get$toString","_this$get","value","toString","JSON","parse","_this2","Array","_this$get2","Object","keys","filter","index","length","forEach","remove","shouldDiff","Function","isTracked","$$primary","diffs","_mageUtils","compare","_notifyChanges","pathComponent","parent","pathComponents","split","lastPathComponent","pop","shift","_underscore","isObject","isFunction","shouldReport"],"sources":["../../ts/js/model/provider.ts"],"sourcesContent":["// @ts-ignore\nimport utils from 'mageUtils';\nimport _ from 'underscore';\nimport Component from 'uiComponent';\nimport RecorderManager from \"VMPL_BugReplay/js/bug-replay/recorder-manager\";\nimport {string} from \"css-tree\";\n\nexport default Component.extend({\n    defaults: {\n        fileHash: 'BugReplay',\n        endpointRequest: '/vmpl-bug-replay/worker/loader',\n        ignoreTmpls: {\n            data: true\n        },\n    },\n    initialize(options: object) {\n        this._super(options);\n        (this.get('$recordEnable') !== undefined && this.get('configuration.enable_toggle') === '1')\n            || this.set('$recordEnable', this.get('configuration.enabled') === '1' ? '1' : '0');\n        (this.get('$reportEnable') !== undefined && this.get('configuration.report_toggle') === '1')\n            || this.set('$reportEnable', this.get('configuration.report') === '1' ? '1' : '0');\n\n        const manager = this._manager();\n        this._set('manager', () => manager);\n        return this;\n    },\n    _manager() {\n        return RecorderManager.init(this.endpointRequest, this.fileHash)\n            .then(manager => {\n                !this.shouldRecord()\n                    || manager.startRecord();\n\n                return manager;\n            })\n    },\n    get(path: string) {\n        if (path.startsWith('$')) {\n            return this.storage().get(path.replace(/^\\$/, ''));\n        }\n\n        if (path.startsWith('!')) {\n            const value = this.get(path.replace(/^!/, ''))?.toString() ?? 'null';\n            return !JSON.parse(value);\n        }\n\n        return this._super(path);\n    },\n    set(path: string, value: any) {\n        if (value instanceof Array) {\n            Object.keys(this.get(path) ?? {})\n                .filter(index => ~~index >= value.length)\n                .forEach(index => this.remove(`${path}.${index}`));\n\n            for (let index in value) {\n                this.set(`${path}.${index}`, value[index]);\n            }\n\n            return this;\n        }\n\n        const data = this.get(path);\n        let shouldDiff = !(data instanceof Function)\n            && !this.isTracked(data);\n\n        shouldDiff = shouldDiff && value.$$primary instanceof Function\n            ? data?.$$primary() !== value.$$primary()\n            : true;\n\n        const diffs = shouldDiff\n            ? utils.compare(data, value, path)\n            : false;\n        this._set(path ,value);\n\n        if (diffs) {\n            this._notifyChanges(diffs);\n        }\n\n        return this;\n    },\n    _set(path: string, value: any) {\n        if (path.startsWith('$')) {\n            return this.storage().set(path.replace(/^\\$/, ''), value);\n        }\n\n        let pathComponent, parent = this;\n        const pathComponents = path.split('.');\n        const lastPathComponent = pathComponents.pop();\n        while(pathComponent = pathComponents.shift()) {\n            if (!_.isObject(parent[pathComponent])) {\n                parent[pathComponent] = {};\n            }\n            parent = parent[pathComponent];\n        }\n        if (_.isFunction(parent[lastPathComponent])) {\n            parent[lastPathComponent](value);\n        } else {\n            parent[lastPathComponent] = value;\n        }\n    },\n    shouldRecord() {\n        let shouldRecord = this.get('configuration.available') === '1';\n        shouldRecord &&= (this.get('configuration.enable_toggle') === '0' && this.get('configuration.enabled') === '1'\n            || this.get('configuration.enable_toggle') === '1' && this.get('$recordEnable') === '1');\n        return shouldRecord;\n    },\n    shouldReport() {\n        let shouldReport = this.get('configuration.available') === '1';\n        shouldReport &&= (this.get('configuration.report_toggle') === '0' && this.get('configuration.report') === '1'\n            || this.get('configuration.report_toggle') === '1' && this.get('$reportEnable') === '1');\n        return shouldReport;\n    }\n})\n"],"mappings":"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"}