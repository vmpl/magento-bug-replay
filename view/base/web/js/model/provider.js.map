{"version":3,"file":"provider.js","names":["_default","_uiComponent","extend","defaults","fileHash","endpointRequest","ignoreTmpls","data","initialize","options","_super","manager","_manager","_set","_this","_recorderManager","init","then","get","startRecord","path","startsWith","storage","replace","set","value","_this2","Array","_this$get","Object","keys","filter","index","length","forEach","remove","shouldDiff","Function","isTracked","$$primary","diffs","_mageUtils","compare","_notifyChanges","pathComponent","parent","pathComponents","split","lastPathComponent","pop","shift","_underscore","isObject","isFunction"],"sources":["../../ts/js/model/provider.ts"],"sourcesContent":["// @ts-ignore\nimport utils from 'mageUtils';\nimport _ from 'underscore';\nimport Component from 'uiComponent';\nimport RecorderManager from \"VMPL_BugReplay/js/bug-replay/recorder-manager\";\n\nexport default Component.extend({\n    defaults: {\n        fileHash: 'BugReplay',\n        endpointRequest: '/vmpl-bug-report/worker/loader',\n        ignoreTmpls: {\n            data: true\n        },\n    },\n    initialize(options: object) {\n        this._super(options);\n        const manager = this._manager();\n        this._set('manager', () => manager);\n        return this;\n    },\n    _manager() {\n        return RecorderManager.init(this.endpointRequest, this.fileHash)\n            .then(manager => {\n                if (this.get('$recordEnable') === '1') {\n                    manager.startRecord();\n                }\n\n                return manager;\n            })\n    },\n    get(path: string) {\n        if (path.startsWith('$')) {\n            return this.storage().get(path.replace(/^\\$/, ''));\n        }\n\n        return this._super(path);\n    },\n    set(path: string, value: any) {\n        if (value instanceof Array) {\n            Object.keys(this.get(path) ?? {})\n                .filter(index => ~~index >= value.length)\n                .forEach(index => this.remove(`${path}.${index}`));\n\n            for (let index in value) {\n                this.set(`${path}.${index}`, value[index]);\n            }\n\n            return this;\n        }\n\n        const data = this.get(path);\n        let shouldDiff = !(data instanceof Function)\n            && !this.isTracked(data);\n\n        shouldDiff = shouldDiff && value.$$primary instanceof Function\n            ? data?.$$primary() !== value.$$primary()\n            : true;\n\n        const diffs = shouldDiff\n            ? utils.compare(data, value, path)\n            : false;\n        this._set(path ,value);\n\n        if (diffs) {\n            this._notifyChanges(diffs);\n        }\n\n        return this;\n    },\n    _set(path: string, value: any) {\n        if (path.startsWith('$')) {\n            return this.storage().set(path.replace(/^\\$/, ''), value);\n        }\n\n        let pathComponent, parent = this;\n        const pathComponents = path.split('.');\n        const lastPathComponent = pathComponents.pop();\n        while(pathComponent = pathComponents.shift()) {\n            if (!_.isObject(parent[pathComponent])) {\n                parent[pathComponent] = {};\n            }\n            parent = parent[pathComponent];\n        }\n        if (_.isFunction(parent[lastPathComponent])) {\n            parent[lastPathComponent](value);\n        } else {\n            parent[lastPathComponent] = value;\n        }\n    },\n})\n"],"mappings":";;;EAAA;EAAA,IAAAA,QAAA,GAMeC,YAAA,CAAUC,MAAM,CAAC;IAC5BC,QAAQ,EAAE;MACNC,QAAQ,EAAE,WAAW;MACrBC,eAAe,EAAE,gCAAgC;MACjDC,WAAW,EAAE;QACTC,IAAI,EAAE;MACV;IACJ,CAAC;IACDC,UAAU,WAAAA,WAACC,OAAe,EAAE;MACxB,IAAI,CAACC,MAAM,CAACD,OAAO,CAAC;MACpB,IAAME,OAAO,GAAG,IAAI,CAACC,QAAQ,CAAC,CAAC;MAC/B,IAAI,CAACC,IAAI,CAAC,SAAS,EAAE;QAAA,OAAMF,OAAO;MAAA,EAAC;MACnC,OAAO,IAAI;IACf,CAAC;IACDC,QAAQ,WAAAA,SAAA,EAAG;MAAA,IAAAE,KAAA;MACP,OAAOC,gBAAA,CAAgBC,IAAI,CAAC,IAAI,CAACX,eAAe,EAAE,IAAI,CAACD,QAAQ,CAAC,CAC3Da,IAAI,CAAC,UAAAN,OAAO,EAAI;QACb,IAAIG,KAAI,CAACI,GAAG,CAAC,eAAe,CAAC,KAAK,GAAG,EAAE;UACnCP,OAAO,CAACQ,WAAW,CAAC,CAAC;QACzB;QAEA,OAAOR,OAAO;MAClB,CAAC,CAAC;IACV,CAAC;IACDO,GAAG,WAAAA,IAACE,IAAY,EAAE;MACd,IAAIA,IAAI,CAACC,UAAU,CAAC,GAAG,CAAC,EAAE;QACtB,OAAO,IAAI,CAACC,OAAO,CAAC,CAAC,CAACJ,GAAG,CAACE,IAAI,CAACG,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;MACtD;MAEA,OAAO,IAAI,CAACb,MAAM,CAACU,IAAI,CAAC;IAC5B,CAAC;IACDI,GAAG,WAAAA,IAACJ,IAAY,EAAEK,KAAU,EAAE;MAAA,IAAAC,MAAA;MAC1B,IAAID,KAAK,YAAYE,KAAK,EAAE;QAAA,IAAAC,SAAA;QACxBC,MAAM,CAACC,IAAI,EAAAF,SAAA,GAAC,IAAI,CAACV,GAAG,CAACE,IAAI,CAAC,YAAAQ,SAAA,GAAI,CAAC,CAAC,CAAC,CAC5BG,MAAM,CAAC,UAAAC,KAAK;UAAA,OAAI,CAAC,CAACA,KAAK,IAAIP,KAAK,CAACQ,MAAM;QAAA,EAAC,CACxCC,OAAO,CAAC,UAAAF,KAAK;UAAA,OAAIN,MAAI,CAACS,MAAM,CAAIf,IAAI,SAAIY,KAAO,CAAC;QAAA,EAAC;QAEtD,KAAK,IAAIA,KAAK,IAAIP,KAAK,EAAE;UACrB,IAAI,CAACD,GAAG,CAAIJ,IAAI,SAAIY,KAAK,EAAIP,KAAK,CAACO,KAAK,CAAC,CAAC;QAC9C;QAEA,OAAO,IAAI;MACf;MAEA,IAAMzB,IAAI,GAAG,IAAI,CAACW,GAAG,CAACE,IAAI,CAAC;MAC3B,IAAIgB,UAAU,GAAG,EAAE7B,IAAI,YAAY8B,QAAQ,CAAC,IACrC,CAAC,IAAI,CAACC,SAAS,CAAC/B,IAAI,CAAC;MAE5B6B,UAAU,GAAGA,UAAU,IAAIX,KAAK,CAACc,SAAS,YAAYF,QAAQ,GACxD,CAAA9B,IAAI,oBAAJA,IAAI,CAAEgC,SAAS,CAAC,CAAC,MAAKd,KAAK,CAACc,SAAS,CAAC,CAAC,GACvC,IAAI;MAEV,IAAMC,KAAK,GAAGJ,UAAU,GAClBK,UAAA,CAAMC,OAAO,CAACnC,IAAI,EAAEkB,KAAK,EAAEL,IAAI,CAAC,GAChC,KAAK;MACX,IAAI,CAACP,IAAI,CAACO,IAAI,EAAEK,KAAK,CAAC;MAEtB,IAAIe,KAAK,EAAE;QACP,IAAI,CAACG,cAAc,CAACH,KAAK,CAAC;MAC9B;MAEA,OAAO,IAAI;IACf,CAAC;IACD3B,IAAI,WAAAA,KAACO,IAAY,EAAEK,KAAU,EAAE;MAC3B,IAAIL,IAAI,CAACC,UAAU,CAAC,GAAG,CAAC,EAAE;QACtB,OAAO,IAAI,CAACC,OAAO,CAAC,CAAC,CAACE,GAAG,CAACJ,IAAI,CAACG,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,EAAEE,KAAK,CAAC;MAC7D;MAEA,IAAImB,aAAa;QAAEC,MAAM,GAAG,IAAI;MAChC,IAAMC,cAAc,GAAG1B,IAAI,CAAC2B,KAAK,CAAC,GAAG,CAAC;MACtC,IAAMC,iBAAiB,GAAGF,cAAc,CAACG,GAAG,CAAC,CAAC;MAC9C,OAAML,aAAa,GAAGE,cAAc,CAACI,KAAK,CAAC,CAAC,EAAE;QAC1C,IAAI,CAACC,WAAA,CAAEC,QAAQ,CAACP,MAAM,CAACD,aAAa,CAAC,CAAC,EAAE;UACpCC,MAAM,CAACD,aAAa,CAAC,GAAG,CAAC,CAAC;QAC9B;QACAC,MAAM,GAAGA,MAAM,CAACD,aAAa,CAAC;MAClC;MACA,IAAIO,WAAA,CAAEE,UAAU,CAACR,MAAM,CAACG,iBAAiB,CAAC,CAAC,EAAE;QACzCH,MAAM,CAACG,iBAAiB,CAAC,CAACvB,KAAK,CAAC;MACpC,CAAC,MAAM;QACHoB,MAAM,CAACG,iBAAiB,CAAC,GAAGvB,KAAK;MACrC;IACJ;EACJ,CAAC,CAAC;EAAA,OAAAzB,QAAA;AAAA"}