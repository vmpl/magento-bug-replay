{"version":3,"file":"items-paginator.js","names":["CompareTypes","CompareType","_dec","serializable","_class","type","_proto","prototype","match","item","against","equal","in","includes","less","more","regex","test","Error","PaginatorFilter","_Object","_inheritsLoose","and","property","compare","value","groups","_this","undefined","call","_proto2","append","_this$groups","push","apply","arguments","items","filter","matchItem","bind","hasOwnProperty","toString","groupsMatched","map","it","getItemValue","propertyComponents","split","itemProperty","shift","itemValue","length","join","_wrapNativeSuper","Object","_default","loader","_filter","_page","_size","totalRecords","_proto3","getCurrentPage","_this2","offset","limit","leftChunk","slice","rightChunk","loadPaginatorItems","then","response","meta","concat","Promise","resolve","_createClass","key","set","lastPage","page","get","assign"],"sources":["../../../../frontend/web/ts/js/lib/items-paginator.ts"],"sourcesContent":["import {\n    ICompare, IPaginatorFilter,\n    IPaginatorLoader,\n    PaginatorItems\n} from \"VMPL_BugReplay/js/api/paginator\";\nimport {serializable} from \"VMPL_BugReplay/js/lib/worker-serializer\";\n\nenum CompareTypes {\n    equal,\n    in,\n    less,\n    more,\n    regex,\n}\n\n@serializable()\nexport class CompareType implements ICompare {\n    constructor(\n        @serializable() protected readonly type: CompareTypes,\n    ) {\n    }\n\n    match(item: any, against: any): boolean {\n        switch (this.type) {\n            case CompareTypes.equal:\n                return item == against;\n            case CompareTypes.in:\n                return against.includes(item);\n            case CompareTypes.less:\n                return item < against;\n            case CompareTypes.more:\n                return item > against;\n            case CompareTypes.regex:\n                return (<RegExp>against).test(<string>item);\n            default:\n                throw new Error(`Case not implemented: ${this.type}`);\n        }\n    }\n}\n\nexport class PaginatorFilter extends Object implements IPaginatorFilter {\n    constructor(\n        public and: boolean = true,\n        public property: PropertyKey = null,\n        public compare: ICompare = new CompareType(CompareTypes.equal),\n        public value: any = undefined,\n        protected groups: PaginatorFilter[] = [],\n    ) {\n        super();\n    }\n\n    append(...filters: [PaginatorFilter]): PaginatorFilter {\n        this.groups.push(...filters);\n        return this;\n    }\n\n    match(items: PaginatorItems): PaginatorItems {\n        return items.filter(this.matchItem.bind(this));\n    }\n\n    protected matchItem(item: Object): boolean {\n        if (!item.hasOwnProperty(this.property)) {\n            throw new Error(`item do not have property named: ${this.property.toString()}`)\n        }\n\n        const groupsMatched: Array<boolean> = this.groups.map(it => it.matchItem(item));\n        groupsMatched.push(this.compare.match(this.getItemValue(item, this.property), this.value));\n\n        return this.and\n            ? !groupsMatched.includes(false)\n            : groupsMatched.includes(true);\n    }\n\n    protected getItemValue(item: any, property: PropertyKey): any {\n        const propertyComponents = (<string>property).split('.');\n        const itemProperty = propertyComponents.shift();\n\n        const itemValue = item.hasOwnProperty(itemProperty) ? item[itemProperty] : undefined;\n        return propertyComponents.length === 0 ? itemValue : this.getItemValue(itemValue, propertyComponents.join('.'));\n    }\n}\n\nexport default class <Items extends PaginatorItems, Loader extends IPaginatorLoader> {\n    protected readonly _filter: PaginatorFilter = new PaginatorFilter();\n    protected _page: number = 1;\n    protected _size: number = 20;\n\n    protected totalRecords: number = undefined;\n\n    set page(value: number) {\n        if (!(this._page > 0)) {\n            throw new Error('Page cannot be lower then 1.');\n        }\n        if (value > this.lastPage) {\n            throw new Error('Page cannot be greater then lastPage.');\n        }\n\n        this._page = value;\n    }\n\n    set size(value: number) {\n        if (value <= 0) {\n            throw new Error('Size have to be greater then 0.');\n        }\n        if (this.totalRecords !== undefined && this.totalRecords > value) {\n            throw new Error('Size is greater then records found');\n        }\n\n        this._size = value;\n    }\n\n    set filter(value: PaginatorFilter) {\n        this.page = 1;\n        this.items = <Items>[];\n        this._filter.append(value);\n    }\n\n    get lastPage(): number {\n        let lastPage = this.totalRecords / this._size;\n        lastPage += this.totalRecords % this._size ? 1 : 0;\n        return lastPage;\n    }\n\n    constructor(\n        protected items: Items,\n        protected readonly loader: Loader,\n    ) {\n    }\n\n    getCurrentPage(): Promise<Items> {\n        const offset = (this._page - 1) * this._size;\n        const limit = this._size;\n\n        if (offset >= this.items.length) {\n            const leftChunk = <Items>this.items.slice(0, offset);\n            const rightChunk: Items = <Items>this.items.slice(offset + limit);\n            return this.loader.loadPaginatorItems(offset, limit, this._filter).then(response => {\n                this.totalRecords = response.meta.totalRecords;\n                this.items = <Items>[].concat(leftChunk, response.items, rightChunk);\n                return <Items>response.items;\n            })\n        }\n\n        return Promise.resolve(<Items>this.items.slice(offset, limit));\n    }\n}\n"],"mappings":"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"}