{"version":3,"file":"player.js","names":["_uiComponent","extend","events","_knockout","observableArray","defaults","template","imports","manager","listens","sessionReplay","session","_this","id","Promise","resolve","thenManager","then","getEventsForSessionAt","afterRender","element","window","addEventListener","bindPlayer","bind","passive","subscribe","lastElementChild","removeChild","width","clientWidth","height","player","rrwebPlayer","target","props","_default"],"sources":["../../ts/js/view/player.ts"],"sourcesContent":["import Component from 'uiComponent';\nimport ko from 'knockout';\nimport ItemSession from \"VMPL_BugReplay/js/model/item-session\";\nimport RecorderManager from \"VMPL_BugReplay/js/lib/recorder-manager\";\nimport {RecordEvent} from \"VMPL_BugReplay/js/lib/session/model/record-event\";\n\ndeclare var rrwebPlayer: any;\n\nexport default Component.extend({\n    events: ko.observableArray<RecordEvent>([]),\n    defaults: {\n        template: 'VMPL_BugReplay/player/rrweb',\n        imports: {\n            manager: '${ $.provider }:manager',\n        },\n        listens: {\n            '${ $.provider }:activeSession': 'sessionReplay',\n        },\n    },\n    sessionReplay(session: ItemSession) {\n        if (!session.id) {\n            return Promise.resolve();\n        }\n\n        const thenManager: Promise<RecorderManager> = this.manager()\n        return thenManager\n            .then(manager => manager.getEventsForSessionAt([session]))\n            .then(events => this.events(events))\n    },\n    afterRender(element: HTMLDivElement) {\n        if (!this.element) {\n            this.element = element;\n            window.addEventListener(\n                'resize',\n                this.bindPlayer.bind(this),\n                {passive: true},\n            )\n        }\n\n        this.events.subscribe(this.bindPlayer.bind(this))\n    },\n    bindPlayer() {\n        while (this.element.lastElementChild) {\n            this.element.removeChild(this.element.lastElementChild);\n        }\n\n        const width = this.element.clientWidth;\n        const height = width * 656 / 1024;\n        const events = this.events();\n\n        this.player = new rrwebPlayer({\n            target: this.element,\n            props: {\n                events,\n                width,\n                height,\n            }\n        })\n    }\n});\n"],"mappings":";;;iBAQeA,YAAA,CAAUC,MAAM,CAAC;IAC5BC,MAAM,EAAEC,SAAA,CAAGC,eAAe,CAAc,EAAE,CAAC;IAC3CC,QAAQ,EAAE;MACNC,QAAQ,EAAE,6BAA6B;MACvCC,OAAO,EAAE;QACLC,OAAO,EAAE;MACb,CAAC;MACDC,OAAO,EAAE;QACL,+BAA+B,EAAE;MACrC;IACJ,CAAC;IACDC,aAAa,WAAAA,cAACC,OAAoB,EAAE;MAAA,IAAAC,KAAA;MAChC,IAAI,CAACD,OAAO,CAACE,EAAE,EAAE;QACb,OAAOC,OAAO,CAACC,OAAO,CAAC,CAAC;MAC5B;MAEA,IAAMC,WAAqC,GAAG,IAAI,CAACR,OAAO,CAAC,CAAC;MAC5D,OAAOQ,WAAW,CACbC,IAAI,CAAC,UAAAT,OAAO;QAAA,OAAIA,OAAO,CAACU,qBAAqB,CAAC,CAACP,OAAO,CAAC,CAAC;MAAA,EAAC,CACzDM,IAAI,CAAC,UAAAf,MAAM;QAAA,OAAIU,KAAI,CAACV,MAAM,CAACA,MAAM,CAAC;MAAA,EAAC;IAC5C,CAAC;IACDiB,WAAW,WAAAA,YAACC,OAAuB,EAAE;MACjC,IAAI,CAAC,IAAI,CAACA,OAAO,EAAE;QACf,IAAI,CAACA,OAAO,GAAGA,OAAO;QACtBC,MAAM,CAACC,gBAAgB,CACnB,QAAQ,EACR,IAAI,CAACC,UAAU,CAACC,IAAI,CAAC,IAAI,CAAC,EAC1B;UAACC,OAAO,EAAE;QAAI,CAClB,CAAC;MACL;MAEA,IAAI,CAACvB,MAAM,CAACwB,SAAS,CAAC,IAAI,CAACH,UAAU,CAACC,IAAI,CAAC,IAAI,CAAC,CAAC;IACrD,CAAC;IACDD,UAAU,WAAAA,WAAA,EAAG;MACT,OAAO,IAAI,CAACH,OAAO,CAACO,gBAAgB,EAAE;QAClC,IAAI,CAACP,OAAO,CAACQ,WAAW,CAAC,IAAI,CAACR,OAAO,CAACO,gBAAgB,CAAC;MAC3D;MAEA,IAAME,KAAK,GAAG,IAAI,CAACT,OAAO,CAACU,WAAW;MACtC,IAAMC,MAAM,GAAGF,KAAK,GAAG,GAAG,GAAG,IAAI;MACjC,IAAM3B,MAAM,GAAG,IAAI,CAACA,MAAM,CAAC,CAAC;MAE5B,IAAI,CAAC8B,MAAM,GAAG,IAAIC,WAAW,CAAC;QAC1BC,MAAM,EAAE,IAAI,CAACd,OAAO;QACpBe,KAAK,EAAE;UACHjC,MAAM,EAANA,MAAM;UACN2B,KAAK,EAALA,KAAK;UACLE,MAAM,EAANA;QACJ;MACJ,CAAC,CAAC;IACN;EACJ,CAAC,CAAC;EAAA,OAAAK,QAAA;AAAA"}