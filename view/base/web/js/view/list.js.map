{"version":3,"file":"list.js","names":["_uiComponent","extend","listOpen","_knockout","observable","itemList","observableArray","itemActive","initialize","options","_this","_super","listSubscribe","subscribe","setActiveItem","slice","shift","dispose","session","id","_sessionReplay","toggleListOpen","dynamicLoad","_this2","_data","manager","then","paginator","getPage","items","_this2$itemList","page","push","apply","isInViewport","catch","error","elementLoadingObserver","disconnect","elementLoading","hidden","afterLoading","element","IntersectionObserver","bind","root","parentElement","threshold","observe","rect","getBoundingClientRect","top","left","bottom","window","innerHeight","document","documentElement","clientHeight","right","innerWidth","clientWidth","_default"],"sources":["../../ts/js/view/list.ts"],"sourcesContent":["import Component from 'uiComponent';\nimport ko from 'knockout';\nimport Data from 'VMPL_BugReplay/js/model/data'\nimport {IRecordSession} from \"VMPL_BugReplay/js/api/session\";\nimport sessionReplay from \"VMPL_BugReplay/js/action/session-replay\";\n\nexport default Component.extend({\n    listOpen: ko.observable(false),\n    itemList: ko.observableArray([]),\n    itemActive: ko.observable(0),\n    initialize(options: object) {\n        this._super(options);\n        const listSubscribe = this.itemList.subscribe(() => {\n            this.setActiveItem(this.itemList.slice(0, 1).shift());\n            listSubscribe.dispose()\n        })\n        return this;\n    },\n    setActiveItem(session: IRecordSession) {\n        this.itemActive(session.id);\n        this.listOpen(false);\n        sessionReplay(session);\n        return this;\n    },\n    toggleListOpen() {\n        this.listOpen(!this.listOpen());\n    },\n    dynamicLoad(): Promise<void> {\n        return Data.manager\n            .then(manager => manager.paginator.getPage()\n                .then((items: IRecordSession[]) => {\n                    manager.paginator.page++\n                    this.itemList.push(...items)\n                })\n                .then(() => {\n                    !this.isInViewport()\n                        || this.dynamicLoad();\n                })\n                .catch((error) => {\n                    this.elementLoadingObserver.disconnect();\n                    this.elementLoading.hidden = true;\n                }))\n\n    },\n    afterLoading(element: HTMLUListElement) {\n        if (!this.elementLoading) {\n            this.elementLoading = element;\n            this.elementLoadingObserver = new IntersectionObserver(\n                this.dynamicLoad.bind(this),\n                {root: this.elementLoading.parentElement, threshold: 0.5}\n            )\n            this.elementLoadingObserver.observe(this.elementLoading);\n        }\n    },\n    isInViewport() {\n        const rect = this.elementLoading.getBoundingClientRect();\n        return (\n            !this.elementLoading.hidden\n            && rect.top >= 0\n            && rect.left >= 0\n            && rect.bottom <= (window.innerHeight || document.documentElement.clientHeight)\n            && rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n        )\n    }\n});\n"],"mappings":"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"}