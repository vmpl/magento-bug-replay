{"version":3,"file":"list.js","names":["ItemSession","_recordSession$Record","_inheritsLoose","_this","_len","arguments","length","args","Array","_key","call","apply","concat","optionsVisible","_knockout","observable","from","child","title","href","timestamp","id","uploaded","events","RecordSession","_default","_uiComponent","extend","defaults","template","itemConfig","component","config","children","options","displayArea","delete","listOpen","itemComponents","observableArray","idActive","initialize","_this2","_super","listSubscribe","subscribe","setActiveItem","slice","shift","dispose","session","item","_sessionReplay","toggleOptionsActive","_this3","find","it","dynamicLoad","_this4","_data","manager","then","paginator","getPage","sessions","Promise","all","map","mapItemComponent","bind","items","_this4$itemComponents","page","push","isInViewport","catch","error","elementLoading","hidden","afterLoading","element","elementLoadingObserver","IntersectionObserver","root","parentElement","threshold","observe","listElement","closest","conteinerElement","rect","getBoundingClientRect","top","left","bottom","window","innerHeight","document","documentElement","clientHeight","right","innerWidth","clientWidth","onItemClick","event","isMobile","getComputedStyle","flexDirection","detail","componentConfig","structuredClone","name","provider","_uiLayout","_uiRegistry","promise"],"sources":["../../ts/js/view/list.ts"],"sourcesContent":["// @ts-ignore\nimport layout from 'uiLayout';\nimport registry from \"uiRegistry\";\nimport Component from 'uiComponent';\nimport ko from 'knockout';\nimport Data from 'VMPL_BugReplay/js/model/data';\nimport sessionReplay from \"VMPL_BugReplay/js/action/session-replay\";\nimport {RecordSession} from \"VMPL_BugReplay/js/lib/session/model/record-session\";\n\nclass ItemSession extends RecordSession {\n    public readonly optionsVisible: KnockoutObservable<boolean> = ko.observable(false);\n\n    static from(child: RecordSession): ItemSession {\n        return new this(\n            child.title,\n            child.href,\n            child.timestamp,\n            child.id,\n            child.uploaded,\n            child.events\n        );\n    }\n}\n\nexport default Component.extend({\n    defaults: {\n        template: 'VMPL_BugReplay/player/list',\n        itemConfig: {\n            component: 'VMPL_BugReplay/js/view/list-item',\n            config: {},\n            children: {\n                options: {\n                    component: 'uiComponent',\n                    displayArea: 'options',\n                    children: {\n                        delete: {\n                            component: 'VMPL_BugReplay/js/view/list-option-delete',\n                            config: {},\n                        }\n                    }\n                }\n            }\n        },\n    },\n    listOpen: ko.observable(false),\n    itemComponents: ko.observableArray([]),\n    idActive: ko.observable(0),\n    initialize(options: object) {\n        this._super(options);\n        const listSubscribe = this.itemComponents.subscribe(() => {\n            this.setActiveItem(this.itemComponents.slice(0, 1).shift());\n            listSubscribe.dispose()\n        })\n        return this;\n    },\n    setActiveItem(component: any) {\n        const session = component.item;\n\n        this.idActive(session.id);\n        this.listOpen(false);\n        sessionReplay(session);\n        return this;\n    },\n    toggleOptionsActive(component?: any) {\n        const session = component ? component : this.itemComponents()\n            .find((it: any) => it.item.id === this.idActive())\n        session?.item.optionsVisible(!session?.item.optionsVisible());\n    },\n    dynamicLoad(): Promise<void> {\n        return Data.manager\n            .then(manager => manager.paginator.getPage()\n                .then(sessions => {\n                    return Promise.all(\n                        sessions.map(it => ItemSession.from(it))\n                            .map(this.mapItemComponent.bind(this))\n                    )\n                })\n                .then(items => {\n                    manager.paginator.page++\n                    this.itemComponents.push(...items)\n                })\n                .then(() => {\n                    !this.isInViewport()\n                        || this.dynamicLoad();\n                })\n                .catch((error) => {\n                    this.elementLoading.hidden = true;\n                }))\n\n    },\n    afterLoading(element: HTMLUListElement) {\n        if (!this.elementLoading) {\n            this.elementLoading = element;\n            this.elementLoadingObserver = new IntersectionObserver(\n                this.dynamicLoad.bind(this),\n                {root: this.elementLoading.parentElement, threshold: 0.5}\n            )\n            this.elementLoadingObserver.observe(this.elementLoading);\n        }\n\n        if (!this.element) {\n            this.element = element;\n            this.listElement = element.closest('.vmpl_session .list');\n            this.conteinerElement = element.closest('.vmpl_session');\n        }\n    },\n    isInViewport() {\n        const rect = this.elementLoading.getBoundingClientRect();\n        return (\n            !this.elementLoading.hidden\n            && rect.top >= 0\n            && rect.left >= 0\n            && rect.bottom <= (window.innerHeight || document.documentElement.clientHeight)\n            && rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n        )\n    },\n    onItemClick(component: any, event: MouseEvent) {\n        const item = component.item;\n        const isMobile = getComputedStyle(this.conteinerElement).flexDirection === 'column';\n        switch (true) {\n            case isMobile && !this.listOpen():\n                this.listOpen(true);\n                break;\n            case isMobile && this.listOpen():\n            case !isMobile && event.detail > 1:\n                this.setActiveItem(item);\n                break;\n            case !isMobile && event.detail === 1:\n                this.toggleOptionsActive(component);\n                break;\n        }\n    },\n    mapItemComponent(it: RecordSession) {\n        const componentConfig = structuredClone(this.itemConfig);\n        componentConfig.name = `${this.name}.${it.id}.item`;\n        componentConfig.config.item = it;\n        componentConfig.config.provider = this.name;\n        componentConfig.idActive = this.idActive;\n        componentConfig.onItemClick = this.onItemClick.bind(this);\n        componentConfig.setActiveItem = this.setActiveItem.bind(this);\n\n        layout([componentConfig]);\n        return registry.promise(componentConfig.name);\n    }\n});\n"],"mappings":"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"}