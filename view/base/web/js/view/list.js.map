{"version":3,"file":"list.js","names":["ItemSession","_recordSession$Record","_inheritsLoose","_this","_len","arguments","length","args","Array","_key","call","apply","concat","options","_knockout","observable","from","child","title","href","timestamp","id","uploaded","events","RecordSession","_default","_uiComponent","extend","listOpen","itemList","observableArray","idActive","initialize","_this2","_super","listSubscribe","subscribe","setActiveItem","slice","shift","dispose","session","_sessionReplay","toggleOptionsActive","chosen","_this3","find","it","dynamicLoad","_this4","_data","manager","then","paginator","getPage","sessions","_this4$itemList","page","items","map","push","isInViewport","catch","error","elementLoading","hidden","afterLoading","element","elementLoadingObserver","IntersectionObserver","bind","root","parentElement","threshold","observe","listElement","closest","conteinerElement","rect","getBoundingClientRect","top","left","bottom","window","innerHeight","document","documentElement","clientHeight","right","innerWidth","clientWidth","onItemClick","item","event","isMobile","getComputedStyle","flexDirection","detail","formatDate","date","Date","toLocaleString","deleteItem","_this5","delete","removeAll"],"sources":["../../ts/js/view/list.ts"],"sourcesContent":["import Component from 'uiComponent';\nimport ko from 'knockout';\nimport Data from 'VMPL_BugReplay/js/model/data';\nimport {IRecordSession} from \"VMPL_BugReplay/js/api/session\";\nimport sessionReplay from \"VMPL_BugReplay/js/action/session-replay\";\nimport {RecordSession} from \"VMPL_BugReplay/js/lib/session/model/record-session\";\n\nclass ItemSession extends RecordSession {\n    public readonly options: KnockoutObservable<boolean> = ko.observable(false);\n\n    static from(child: RecordSession): ItemSession {\n        return new this(\n            child.title,\n            child.href,\n            child.timestamp,\n            child.id,\n            child.uploaded,\n            child.events\n        );\n    }\n}\n\nexport default Component.extend({\n    listOpen: ko.observable(false),\n    itemList: ko.observableArray([]),\n    idActive: ko.observable(0),\n    initialize(options: object) {\n        this._super(options);\n        const listSubscribe = this.itemList.subscribe(() => {\n            this.setActiveItem(this.itemList.slice(0, 1).shift());\n            listSubscribe.dispose()\n        })\n        return this;\n    },\n    setActiveItem(session: ItemSession) {\n        this.idActive(session.id);\n        this.listOpen(false);\n        sessionReplay(session);\n        return this;\n    },\n    toggleOptionsActive(chosen?: ItemSession) {\n        const session = chosen ? chosen : this.itemList()\n            .find((it: ItemSession) => it.id === this.idActive())\n        session?.options(!session?.options());\n    },\n    dynamicLoad(): Promise<void> {\n        return Data.manager\n            .then(manager => manager.paginator.getPage()\n                .then(sessions => {\n                    manager.paginator.page++\n                    const items = sessions.map(it => ItemSession.from(it));\n                    this.itemList.push(...items)\n                })\n                .then(() => {\n                    !this.isInViewport()\n                        || this.dynamicLoad();\n                })\n                .catch((error) => {\n                    this.elementLoading.hidden = true;\n                }))\n\n    },\n    afterLoading(element: HTMLUListElement) {\n        if (!this.elementLoading) {\n            this.elementLoading = element;\n            this.elementLoadingObserver = new IntersectionObserver(\n                this.dynamicLoad.bind(this),\n                {root: this.elementLoading.parentElement, threshold: 0.5}\n            )\n            this.elementLoadingObserver.observe(this.elementLoading);\n        }\n\n        if (!this.element) {\n            this.element = element;\n            this.listElement = element.closest('.vmpl_session .list');\n            this.conteinerElement = element.closest('.vmpl_session');\n        }\n    },\n    isInViewport() {\n        const rect = this.elementLoading.getBoundingClientRect();\n        return (\n            !this.elementLoading.hidden\n            && rect.top >= 0\n            && rect.left >= 0\n            && rect.bottom <= (window.innerHeight || document.documentElement.clientHeight)\n            && rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n        )\n    },\n    onItemClick(item: RecordSession, event: MouseEvent) {\n        const isMobile = getComputedStyle(this.conteinerElement).flexDirection === 'column';\n        switch (true) {\n            case isMobile && !this.listOpen():\n                this.listOpen(true);\n                break;\n            case isMobile && this.listOpen():\n            case !isMobile && event.detail > 1:\n                this.setActiveItem(item);\n                break;\n            case !isMobile && event.detail === 1:\n                this.toggleOptionsActive(item);\n                break;\n        }\n    },\n    formatDate(timestamp: number): string {\n        const date = new Date(timestamp);\n        return date.toLocaleString();\n    },\n    deleteItem(item: RecordSession) {\n        return Data.manager\n            .then(manager => manager.delete([item]))\n            .then(() => this.itemList.removeAll())\n            .then(() => {\n                this.elementLoading.hidden = false;\n            })\n    }\n});\n"],"mappings":"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"}