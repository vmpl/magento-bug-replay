{"version":3,"file":"list.js","names":["_default","_uiComponent","extend","listOpen","_knockout","observable","sessions","observableArray","itemComponents","defaults","template","exports","itemConfig","component","config","provider","children","options","displayArea","delete","initObservable","_this","_super","listSubscribe","subscribe","slice","shift","activeSession","item","dispose","toggleOptionsActive","_this2","session","find","it","id","idActive","optionsVisible","dynamicLoad","_this3","_data","manager","then","paginator","getPage","_this3$sessions","itemSessions","map","ItemSessionFactory","create","push","apply","Promise","all","mapItemComponent","bind","items","_this3$itemComponents","page","isInViewport","catch","error","ItemPaginatorException","elementLoading","hidden","afterLoading","element","elementLoadingObserver","IntersectionObserver","root","parentElement","threshold","observe","listElement","closest","conteinerElement","rect","getBoundingClientRect","top","left","bottom","window","innerHeight","document","documentElement","clientHeight","right","innerWidth","clientWidth","onItemClick","event","isMobile","getComputedStyle","flexDirection","detail","setActiveItem","itemSession","componentConfig","structuredClone","name","itemIndex","indexOf","_uiLayout","_uiRegistry","promise"],"sources":["../../ts/js/view/list.ts"],"sourcesContent":["// @ts-ignore\nimport layout from 'uiLayout';\nimport registry from \"uiRegistry\";\nimport Component from 'uiComponent';\nimport ko from 'knockout';\nimport Data from 'VMPL_BugReplay/js/model/data';\nimport ItemSession, {ItemSessionFactory} from \"VMPL_BugReplay/js/model/item-session\";\nimport {Exception as ItemPaginatorException} from \"VMPL_BugReplay/js/lib/items-paginator\";\n\nexport default Component.extend({\n    listOpen: ko.observable(false),\n    sessions: ko.observableArray<ItemSession>([]),\n    itemComponents: ko.observableArray([]),\n    defaults: {\n        template: 'VMPL_BugReplay/player/list',\n        exports: {\n            sessions: '${ $.provider }:sessions',\n        },\n        itemConfig: {\n            component: 'VMPL_BugReplay/js/view/list-item',\n            config: {\n                provider: '${ $.provider }',\n            },\n            children: {\n                options: {\n                    component: 'uiComponent',\n                    displayArea: 'options',\n                    children: {\n                        delete: {\n                            component: 'VMPL_BugReplay/js/view/list-option-delete',\n                            config: {},\n                        }\n                    }\n                }\n            }\n        },\n    },\n    initObservable() {\n        this._super();\n\n        const listSubscribe = this.itemComponents.subscribe(() => {\n            const component = this.itemComponents.slice(0, 1).shift();\n            component.activeSession(component.item);\n\n            listSubscribe.dispose()\n        })\n\n        return this;\n    },\n    toggleOptionsActive(component?: any) {\n        const session = component ? component : this.itemComponents()\n            .find((it: any) => it.item.id === this.idActive())\n        session?.item.optionsVisible(!session?.item.optionsVisible());\n    },\n    dynamicLoad(): Promise<void> {\n        return Data.manager\n            .then(manager => manager.paginator.getPage()\n                .then(sessions => {\n                    const itemSessions = sessions.map(it => ItemSessionFactory.create(it));\n                    this.sessions.push(...itemSessions);\n\n                    return Promise.all(itemSessions.map(this.mapItemComponent.bind(this)))\n                })\n                .then(items => {\n                    manager.paginator.page++\n                    this.itemComponents.push(...items);\n                })\n                .then(() => {\n                    !this.isInViewport()\n                        || this.dynamicLoad();\n                })\n                .catch(error => {\n                    if (error instanceof ItemPaginatorException) {\n                        this.elementLoading.hidden = true;\n                        return;\n                    }\n\n                    throw error;\n                }))\n\n    },\n    afterLoading(element: HTMLUListElement) {\n        if (!this.elementLoading) {\n            this.elementLoading = element;\n            this.elementLoadingObserver = new IntersectionObserver(\n                this.dynamicLoad.bind(this),\n                {root: this.elementLoading.parentElement, threshold: 0.5}\n            )\n            this.elementLoadingObserver.observe(this.elementLoading);\n        }\n\n        if (!this.element) {\n            this.element = element;\n            this.listElement = element.closest('.vmpl_session .list');\n            this.conteinerElement = element.closest('.vmpl_session');\n        }\n    },\n    isInViewport() {\n        const rect = this.elementLoading.getBoundingClientRect();\n        return (\n            !this.elementLoading.hidden\n            && rect.top >= 0\n            && rect.left >= 0\n            && rect.bottom <= (window.innerHeight || document.documentElement.clientHeight)\n            && rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n        )\n    },\n    onItemClick(component: any, event: MouseEvent) {\n        const isMobile = getComputedStyle(this.conteinerElement).flexDirection === 'column';\n        switch (true) {\n            case isMobile && !this.listOpen():\n                this.listOpen(true);\n                break;\n            case isMobile && this.listOpen():\n            case !isMobile && event.detail > 1:\n                this.setActiveItem(component);\n                break;\n            case !isMobile && event.detail === 1:\n                this.toggleOptionsActive(component);\n                break;\n        }\n    },\n    mapItemComponent(itemSession: ItemSession) {\n        const componentConfig = structuredClone(this.itemConfig);\n        componentConfig.name = `${this.name}.item_${itemSession.id}`;\n        componentConfig.itemIndex = this.sessions.indexOf(itemSession);\n\n        layout([componentConfig]);\n        return registry.promise(componentConfig.name)\n    }\n});\n"],"mappings":"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"}