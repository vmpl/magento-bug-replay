{"version":3,"file":"dialog-catch-error.js","names":["_dialog","extend","defaults","template","content","title","message","preview","upload","close","elementConfig","class","_knockout","observable","imports","manager","configurationIgnoreRules","initialize","options","_super","ignoreRules","split","map","it","components","trim","RegExp","at","e","filter","initObservable","window","addEventListener","DataEvent","Types","NewSessionWithError","onSessionError","bind","event","_this","result","data","errors","_iterator","_createForOfIteratorHelperLoose","_step","done","ignoreRule","value","test","length","sessionId","source","shouldReport","uploadSession","show","_this2","then","session","uploadSessions","modalPreview","_this3","previewPlayer","getChild","sessionReplay","_default"],"sources":["../../ts/js/view/dialog-catch-error.ts"],"sourcesContent":["import Dialog from \"VMPL_BugReplay/js/view/dialog\";\nimport RecorderManager, {DataEvent} from \"VMPL_BugReplay/js/bug-replay/recorder-manager\";\nimport ko from \"knockout\";\nimport {EventPostResult} from \"VMPL_BugReplay/js/api/session\";\nimport tr from \"../../../moment/locale/tr\";\n\nexport default Dialog.extend({\n    defaults: {\n        template: 'VMPL_BugReplay/dialog/catch-error',\n        content: {\n            title: 'Error Detected.',\n            message: 'In previos sessions error was caught, the recording was saved on your browser memory.',\n            preview: 'Preview',\n            upload: 'Upload',\n            close: 'Close',\n        },\n        elementConfig: {\n            class: ko.observable<string>('message info left-bottom'),\n        },\n        imports: {\n            manager: '${ $.provider }:manager',\n            configurationIgnoreRules: '${ $.provider }:configuration.ignore_rules',\n        },\n    },\n    initialize(options: object) {\n        this._super(options);\n\n        this.ignoreRules = (this.configurationIgnoreRules || '').split('\\n')\n            .map((it: string) => {\n                if (it === \"\") {\n                    return null;\n                }\n\n                const components: Array<string> = it.trim().split('/');\n                try {\n                    return new RegExp(components.at(1), components.at(2))\n                } catch (e) {\n                    return null;\n                }\n            }).filter((it?: RegExp) => it !== null);\n\n        return this;\n    },\n    initObservable() {\n        this._super();\n        window.addEventListener(\n            DataEvent.Types.NewSessionWithError,\n            this.onSessionError.bind(this),\n        );\n        return this;\n    },\n    onSessionError(event: DataEvent) {\n        const result = <EventPostResult>event.data;\n        result.errors = result.errors.filter(it => {\n            for (let ignoreRule of this.ignoreRules) {\n                if (ignoreRule.test(it.message)) {\n                    return false;\n                }\n            }\n\n            return true;\n        })\n\n        if (result.errors.length === 0) {\n            return;\n        }\n\n        this.sessionId = result.sessionId;\n        this.source.shouldReport()\n            ? this.uploadSession()\n            : this.show(true);\n    },\n    uploadSession() {\n        (<Promise<RecorderManager>>this.manager())\n            .then(manager => {\n                return manager.session(this.sessionId)\n                    .then(session => manager.uploadSessions([session]))\n                    .then(() => this.show(false));\n            })\n    },\n    modalPreview() {\n        (<Promise<RecorderManager>>this.manager())\n            .then(manager => manager.session(this.sessionId))\n            .then(session => {\n                this.elementConfig.class('message info full-center');\n\n                const previewPlayer = this.getChild('previewPlayer')\n                previewPlayer.sessionReplay(session);\n            })\n    }\n});\n"],"mappings":"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"}